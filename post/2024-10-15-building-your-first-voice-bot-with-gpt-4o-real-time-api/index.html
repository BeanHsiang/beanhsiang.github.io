<!doctype html>
<html lang="zh-Hans">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="referrer" content="no-referrer-when-downgrade">
    

    <title>使用 GPT-4o 实时 API 构建一个语音机器人 | Innovation with tech</title>
    <meta property="og:title" content="使用 GPT-4o 实时 API 构建一个语音机器人 - Innovation with tech">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2024-10-15T12:00:00&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2024-10-15T12:00:00&#43;08:00'>
        
    <meta name="Keywords" content="C#,.Net,Python,Nodejs,Java,Golang,博客,软件架构,云原生,机器学习,数据分析,RPA,自动化,技术管理">
    <meta name="description" content="使用 GPT-4o 实时 API 构建一个语音机器人">
    <meta name="author" content="">
    <meta property="og:url" content="https://beanhsiang.github.io/post/2024-10-15-building-your-first-voice-bot-with-gpt-4o-real-time-api/">
    <link rel="shortcut icon" href='/favicon.ico'  type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    
    
        <link href="https://cdn.bootcdn.net/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" rel="stylesheet">
    
    
    
    
</head>

<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://beanhsiang.github.io/">
                        Innovation with tech
                    </a>
                
                <p class="description">一个技术老兵工作的点滴记录，专注、沟通、乐在分享!</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="current" href="https://beanhsiang.github.io/">首页</a>
                    
                    <a  href="https://beanhsiang.github.io/tools/" title="工具">工具</a>
                    
                    <a  href="https://beanhsiang.github.io/archives/" title="归档">归档</a>
                    
                    <a  href="https://beanhsiang.github.io/about/" title="关于">关于</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    
    <article class="post">
        <header>
            <h1 class="post-title">使用 GPT-4o 实时 API 构建一个语音机器人</h1>
        </header>
        
  <time datetime="2024-10-15T04:00:00Z" class="post-meta meta-date dt-published">
    2024年10月15日
  </time>


<div class="post-meta meta-category">
  <span>&nbsp;|</span>
  
    <a href='/categories/Azure-AI' target="_blank">Azure AI</a>
  
</div>


        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">&nbsp;|
                <span id="busuanzi_value_page_pv"></span> <span>阅读</span>
            </span>
        </div>
        
        
        <div class="post-content">
            <p>语音技术正在改变我们与机器互动的方式，使与AI的对话感觉比以往任何时候都更加自然。随着 GPT-4o 实时API的公开测试版发布，开发人员现在可以使用这些工具在应用程序中创建低延迟、多模态的语音体验，从而为创新开辟了无限的可能性。</p>
<p>过去构建语音机器人需要将多个模型拼接在一起，用于语音识别、推理和文本转语音等操作。而现在借助实时API，开发者只需通过一个API调用即可完成整个过程，从而实现流畅、自然的语音对话。这对于客户支持、教育和实时语言翻译等行业来说是一个重大变革，因为在这些行业中，快速、无缝的交互至关重要。</p>
<p>本博客将指导您从头开始使用 GPT-4o 实时模型构建第一个实时语音机器人。我们将介绍实时API的关键功能，如何设置用于语音流的 WebSocket 连接，以及如何利用API处理中断和调用函数的能力。完成后，您将准备好创建一个语音机器人，它可以以接近人类的准确性和情感响应用户。无论您是新手还是有经验的开发人员，这都将帮助您开始创建具有响应性和吸引力的沉浸式语音交互。</p>
<h2 id="关键特性">关键特性</h2>
<ul>
<li>低延迟流媒体：实现实时音频输入和输出，促进自然流畅的对话。</li>
<li>多模态支持：既能处理文本输入和输出，也能处理音频输入和输出，从而实现灵活多样的交互模式。</li>
<li>预设声音：支持六种预设声音，确保回复的质量和一致性。</li>
<li>函数调用：允许语音助手根据上下文动态执行操作或获取特定信息。</li>
<li>安全与隐私：采用多层安全保护措施，包括自动化监控和遵守隐私政策。</li>
</ul>
<h2 id="gpt-4o-实时api是如何工作的">GPT-4o 实时API是如何工作的？</h2>
<p>传统上，构建语音助手需要将多个模型串联起来：一个用于转录音频的自动语音识别（ASR）模型，如Whisper；一个用于处理响应的基于文本的模型；以及一个用于生成音频输出的文本到语音（TTS）模型。这种多步骤过程往往会导致延迟和情感细微差别的丢失。</p>
<p>GPT-4o 实时API通过将这些功能整合到一个API调用中，彻底改变了这一现状。通过建立持久的 WebSocket 连接，开发人员可以直接流式传输音频输入和输出，大大降低了延迟，增强了对话的自然性。此外，API的函数调用功能还允许语音机器人在需要时执行诸如下订单或获取客户信息等操作。</p>
<h2 id="构建实时语音机器人">构建实时语音机器人</h2>
<p>在开始之前，请确保已经具备以下条件：</p>
<ul>
<li>Azure 订阅：免费创建一个。</li>
<li>Azure OpenAI资源：在支持的区域（美东2区或瑞典中部）中设置。</li>
<li>开发环境：熟悉 Python 语言以及基本的异步编程。</li>
<li>客户端库：如LiveKit、Agora或Twilio等工具可以增强机器人的功能。</li>
</ul>
<h3 id="设置api">设置API</h3>
<ol>
<li>
<p>部署GPT-4o实时模型：</p>
<ul>
<li>导航至 Azure AI Studio。</li>
<li>访问模型目录并搜索“gpt-4o-realtime-preview”。</li>
<li>通过选择 Azure OpenAI 资源并配置部署设置来部署模型。</li>
</ul>
</li>
<li>
<p>配置音频输入和输出：</p>
<ul>
<li>该API支持多种音频格式，主要为PCM16。</li>
<li>设置客户端以处理音频流，确保与API的要求兼容。</li>
</ul>
</li>
</ol>
<p>本示例展示了如何使用 Azure OpenAI 构建一个高级的实时对话式 AI 系统。通过利用 WebSocket 连接和事件驱动架构，该系统可以在任何语言下提供响应迅速且语境敏感的客户支持服务。这种方法可以适用于多种语言和场景，因此对于希望提升客户服务能力的企业来说，它是一种灵活的解决方案。该项目包含三个主要组件：</p>
<ul>
<li>实时API：处理与Azure OpenAI的实时API的WebSocket连接。</li>
<li>工具：定义了各种客户支持功能，如查询订单状态、处理退货等。</li>
<li>应用：管理交互流程并与UI层集成实时客户端。</li>
</ul>
<h3 id="环境设置">环境设置</h3>
<p>创建一个名为<code>.env</code>的文件，并更新以下环境变量：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#008080">AZURE_OPENAI_API_KEY</span><span style="color:#000;font-weight:bold">=</span>XXXX
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># replace with your Azure OpenAI API Key</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#008080">AZURE_OPENAI_ENDPOINT</span><span style="color:#000;font-weight:bold">=</span>https://xxxx.openai.azure.com/
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># replace with your Azure OpenAI Endpoint</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#008080">AZURE_OPENAI_DEPLOYMENT</span><span style="color:#000;font-weight:bold">=</span>gpt-4o-realtime-preview
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#Create a deployment for the gpt-4o-realtime-preview model and place the deployment name here. You can name the deployment as per your choice and put the name here.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#008080">AZURE_OPENAI_CHAT_DEPLOYMENT_VERSION</span><span style="color:#000;font-weight:bold">=</span>2024-10-01-preview
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#You don&#39;t need to change this unless you are willing to try other versions.</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>创建一个名为<code>requirements.txt</code>的文件，并添加以下内容：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#008080">chainlit</span><span style="color:#000;font-weight:bold">==</span>1.3.0rc1
</span></span><span style="display:flex;"><span>openai
</span></span><span style="display:flex;"><span>beautifulsoup4
</span></span><span style="display:flex;"><span>lxml
</span></span><span style="display:flex;"><span>python-dotenv
</span></span><span style="display:flex;"><span>websockets
</span></span><span style="display:flex;"><span>aiohttp
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="实现实时客户端">实现实时客户端</h3>
<p>你的语音机器人的心跳是实时客户端，它管理WebSocket连接并处理与GPT-4o实时API的通信。RealtimeAPI类负责管理与OpenAI实时API的WebSocket连接。它负责发送和接收消息、分发事件，并维护连接状态。主要包括：</p>
<ul>
<li>连接管理：建立并维护WebSocket连接。</li>
<li>事件分发：采用事件驱动架构来处理输入和输出消息。</li>
<li>音频处理：使用实用工具函数将Base64编码的音频输入转换为数组缓冲区，反之亦然。高效管理音频流，确保最小的延迟和高质量的语音交互。</li>
</ul>
<h4 id="关键组件">关键组件</h4>
<h5 id="实时api类">实时API类</h5>
<ul>
<li>建立并维护WebSocket连接。</li>
<li>负责发送和接收消息。</li>
<li>负责处理各种对话事件的分发。</li>
</ul>
<p>参考: <a href="https://github.com/monuminu/AOAI_Samples/blob/main/realtime-assistant-support/realtime/__init__.py">init.py</a></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">RealtimeAPI</span>(RealtimeEventHandler):
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> __init__(<span style="color:#999">self</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#0086b3">super</span>()<span style="color:#000;font-weight:bold">.</span>__init__()
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>default_url <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;wss://api.openai.com/v1/realtime&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>url <span style="color:#000;font-weight:bold">=</span> os<span style="color:#000;font-weight:bold">.</span>environ[<span style="color:#d14">&#34;AZURE_OPENAI_ENDPOINT&#34;</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>api_key <span style="color:#000;font-weight:bold">=</span> os<span style="color:#000;font-weight:bold">.</span>environ[<span style="color:#d14">&#34;AZURE_OPENAI_API_KEY&#34;</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>api_version <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;2024-10-01-preview&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>azure_deployment <span style="color:#000;font-weight:bold">=</span> os<span style="color:#000;font-weight:bold">.</span>environ[<span style="color:#d14">&#34;AZURE_OPENAI_DEPLOYMENT&#34;</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>ws <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">is_connected</span>(<span style="color:#999">self</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>ws <span style="color:#000;font-weight:bold">is</span> <span style="color:#000;font-weight:bold">not</span> <span style="color:#000;font-weight:bold">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">log</span>(<span style="color:#999">self</span>, <span style="color:#000;font-weight:bold">*</span>args):
</span></span><span style="display:flex;"><span>        logger<span style="color:#000;font-weight:bold">.</span>debug(<span style="color:#d14">f</span><span style="color:#d14">&#34;[Websocket/</span><span style="color:#d14">{</span>datetime<span style="color:#000;font-weight:bold">.</span>utcnow()<span style="color:#000;font-weight:bold">.</span>isoformat()<span style="color:#d14">}</span><span style="color:#d14">]&#34;</span>, <span style="color:#000;font-weight:bold">*</span>args)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">async</span> <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">connect</span>(<span style="color:#999">self</span>, model<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;gpt-4o-realtime-preview&#39;</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>is_connected():
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">raise</span> <span style="color:#900;font-weight:bold">Exception</span>(<span style="color:#d14">&#34;Already connected&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>ws <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">await</span> websockets<span style="color:#000;font-weight:bold">.</span>connect(<span style="color:#d14">f</span><span style="color:#d14">&#34;</span><span style="color:#d14">{</span><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>url<span style="color:#d14">}</span><span style="color:#d14">/openai/realtime?api-version=</span><span style="color:#d14">{</span><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>api_version<span style="color:#d14">}</span><span style="color:#d14">&amp;deployment=</span><span style="color:#d14">{</span>model<span style="color:#d14">}</span><span style="color:#d14">&amp;api-key=</span><span style="color:#d14">{</span><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>api_key<span style="color:#d14">}</span><span style="color:#d14">&#34;</span>, extra_headers<span style="color:#000;font-weight:bold">=</span>{
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#39;Authorization&#39;</span>: <span style="color:#d14">f</span><span style="color:#d14">&#39;Bearer </span><span style="color:#d14">{</span><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>api_key<span style="color:#d14">}</span><span style="color:#d14">&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#39;OpenAI-Beta&#39;</span>: <span style="color:#d14">&#39;realtime=v1&#39;</span>
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>log(<span style="color:#d14">f</span><span style="color:#d14">&#34;Connected to </span><span style="color:#d14">{</span><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>url<span style="color:#d14">}</span><span style="color:#d14">&#34;</span>)
</span></span><span style="display:flex;"><span>        asyncio<span style="color:#000;font-weight:bold">.</span>create_task(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_receive_messages())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">async</span> <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_receive_messages</span>(<span style="color:#999">self</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">async</span> <span style="color:#000;font-weight:bold">for</span> message <span style="color:#000;font-weight:bold">in</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>ws:
</span></span><span style="display:flex;"><span>            event <span style="color:#000;font-weight:bold">=</span> json<span style="color:#000;font-weight:bold">.</span>loads(message)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">if</span> event[<span style="color:#d14">&#39;type&#39;</span>] <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#34;error&#34;</span>:
</span></span><span style="display:flex;"><span>                logger<span style="color:#000;font-weight:bold">.</span>error(<span style="color:#d14">&#34;ERROR&#34;</span>, message)
</span></span><span style="display:flex;"><span>            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>log(<span style="color:#d14">&#34;received:&#34;</span>, event)
</span></span><span style="display:flex;"><span>            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>dispatch(<span style="color:#d14">f</span><span style="color:#d14">&#34;server.</span><span style="color:#d14">{</span>event[<span style="color:#d14">&#39;type&#39;</span>]<span style="color:#d14">}</span><span style="color:#d14">&#34;</span>, event)
</span></span><span style="display:flex;"><span>            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>dispatch(<span style="color:#d14">&#34;server.*&#34;</span>, event)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">async</span> <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">send</span>(<span style="color:#999">self</span>, event_name, data<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">None</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">not</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>is_connected():
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">raise</span> <span style="color:#900;font-weight:bold">Exception</span>(<span style="color:#d14">&#34;RealtimeAPI is not connected&#34;</span>)
</span></span><span style="display:flex;"><span>        data <span style="color:#000;font-weight:bold">=</span> data <span style="color:#000;font-weight:bold">or</span> {}
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">not</span> <span style="color:#0086b3">isinstance</span>(data, <span style="color:#0086b3">dict</span>):
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">raise</span> <span style="color:#900;font-weight:bold">Exception</span>(<span style="color:#d14">&#34;data must be a dictionary&#34;</span>)
</span></span><span style="display:flex;"><span>        event <span style="color:#000;font-weight:bold">=</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#34;event_id&#34;</span>: <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_generate_id(<span style="color:#d14">&#34;evt_&#34;</span>),
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#34;type&#34;</span>: event_name,
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">**</span>data
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>dispatch(<span style="color:#d14">f</span><span style="color:#d14">&#34;client.</span><span style="color:#d14">{</span>event_name<span style="color:#d14">}</span><span style="color:#d14">&#34;</span>, event)
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>dispatch(<span style="color:#d14">&#34;client.*&#34;</span>, event)
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>log(<span style="color:#d14">&#34;sent:&#34;</span>, event)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">await</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>ws<span style="color:#000;font-weight:bold">.</span>send(json<span style="color:#000;font-weight:bold">.</span>dumps(event))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_generate_id</span>(<span style="color:#999">self</span>, prefix):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#d14">f</span><span style="color:#d14">&#34;</span><span style="color:#d14">{</span>prefix<span style="color:#d14">}{</span><span style="color:#0086b3">int</span>(datetime<span style="color:#000;font-weight:bold">.</span>utcnow()<span style="color:#000;font-weight:bold">.</span>timestamp() <span style="color:#000;font-weight:bold">*</span> <span style="color:#099">1000</span>)<span style="color:#d14">}</span><span style="color:#d14">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">async</span> <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">disconnect</span>(<span style="color:#999">self</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>ws:
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">await</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>ws<span style="color:#000;font-weight:bold">.</span>close()
</span></span><span style="display:flex;"><span>            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>ws <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">None</span>
</span></span><span style="display:flex;"><span>            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>log(<span style="color:#d14">f</span><span style="color:#d14">&#34;Disconnected from </span><span style="color:#d14">{</span><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>url<span style="color:#d14">}</span><span style="color:#d14">&#34;</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="实时对话类">实时对话类</h5>
<ul>
<li>管理对话的状态。</li>
<li>处理各种类型的事件，例如消息创建、转录完成和音频流。</li>
<li>负责管理音频和文本数据的队列，以实现无缝交互。</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">150
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">151
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">152
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">153
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">154
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">155
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">156
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">157
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">158
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">159
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">160
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">161
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">162
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">163
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">164
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">165
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">166
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">167
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">168
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">169
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">170
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">171
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">172
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">173
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">174
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">175
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">176
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">177
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">178
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">179
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">180
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">181
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">182
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">183
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">184
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">185
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">186
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">187
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">188
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">189
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">190
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">191
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">192
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">193
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">194
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">195
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">196
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">197
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">198
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">199
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">200
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">201
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">202
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">203
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">204
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">205
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">206
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">207
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">208
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">209
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">210
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">211
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">212
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">213
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">214
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">215
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">216
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">217
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">218
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">219
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">RealtimeConversation</span>:
</span></span><span style="display:flex;"><span>    default_frequency <span style="color:#000;font-weight:bold">=</span> config<span style="color:#000;font-weight:bold">.</span>features<span style="color:#000;font-weight:bold">.</span>audio<span style="color:#000;font-weight:bold">.</span>sample_rate
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    EventProcessors <span style="color:#000;font-weight:bold">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#d14">&#39;conversation.item.created&#39;</span>: <span style="color:#000;font-weight:bold">lambda</span> <span style="color:#999">self</span>, event: <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_process_item_created(event),
</span></span><span style="display:flex;"><span>        <span style="color:#d14">&#39;conversation.item.truncated&#39;</span>: <span style="color:#000;font-weight:bold">lambda</span> <span style="color:#999">self</span>, event: <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_process_item_truncated(event),
</span></span><span style="display:flex;"><span>        <span style="color:#d14">&#39;conversation.item.deleted&#39;</span>: <span style="color:#000;font-weight:bold">lambda</span> <span style="color:#999">self</span>, event: <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_process_item_deleted(event),
</span></span><span style="display:flex;"><span>        <span style="color:#d14">&#39;conversation.item.input_audio_transcription.completed&#39;</span>: <span style="color:#000;font-weight:bold">lambda</span> <span style="color:#999">self</span>, event: <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_process_input_audio_transcription_completed(event),
</span></span><span style="display:flex;"><span>        <span style="color:#d14">&#39;input_audio_buffer.speech_started&#39;</span>: <span style="color:#000;font-weight:bold">lambda</span> <span style="color:#999">self</span>, event: <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_process_speech_started(event),
</span></span><span style="display:flex;"><span>        <span style="color:#d14">&#39;input_audio_buffer.speech_stopped&#39;</span>: <span style="color:#000;font-weight:bold">lambda</span> <span style="color:#999">self</span>, event, input_audio_buffer: <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_process_speech_stopped(event, input_audio_buffer),
</span></span><span style="display:flex;"><span>        <span style="color:#d14">&#39;response.created&#39;</span>: <span style="color:#000;font-weight:bold">lambda</span> <span style="color:#999">self</span>, event: <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_process_response_created(event),
</span></span><span style="display:flex;"><span>        <span style="color:#d14">&#39;response.output_item.added&#39;</span>: <span style="color:#000;font-weight:bold">lambda</span> <span style="color:#999">self</span>, event: <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_process_output_item_added(event),
</span></span><span style="display:flex;"><span>        <span style="color:#d14">&#39;response.output_item.done&#39;</span>: <span style="color:#000;font-weight:bold">lambda</span> <span style="color:#999">self</span>, event: <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_process_output_item_done(event),
</span></span><span style="display:flex;"><span>        <span style="color:#d14">&#39;response.content_part.added&#39;</span>: <span style="color:#000;font-weight:bold">lambda</span> <span style="color:#999">self</span>, event: <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_process_content_part_added(event),
</span></span><span style="display:flex;"><span>        <span style="color:#d14">&#39;response.audio_transcript.delta&#39;</span>: <span style="color:#000;font-weight:bold">lambda</span> <span style="color:#999">self</span>, event: <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_process_audio_transcript_delta(event),
</span></span><span style="display:flex;"><span>        <span style="color:#d14">&#39;response.audio.delta&#39;</span>: <span style="color:#000;font-weight:bold">lambda</span> <span style="color:#999">self</span>, event: <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_process_audio_delta(event),
</span></span><span style="display:flex;"><span>        <span style="color:#d14">&#39;response.text.delta&#39;</span>: <span style="color:#000;font-weight:bold">lambda</span> <span style="color:#999">self</span>, event: <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_process_text_delta(event),
</span></span><span style="display:flex;"><span>        <span style="color:#d14">&#39;response.function_call_arguments.delta&#39;</span>: <span style="color:#000;font-weight:bold">lambda</span> <span style="color:#999">self</span>, event: <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_process_function_call_arguments_delta(event),
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> __init__(<span style="color:#999">self</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>clear()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">clear</span>(<span style="color:#999">self</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>item_lookup <span style="color:#000;font-weight:bold">=</span> {}
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>items <span style="color:#000;font-weight:bold">=</span> []
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>response_lookup <span style="color:#000;font-weight:bold">=</span> {}
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>responses <span style="color:#000;font-weight:bold">=</span> []
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>queued_speech_items <span style="color:#000;font-weight:bold">=</span> {}
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>queued_transcript_items <span style="color:#000;font-weight:bold">=</span> {}
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>queued_input_audio <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">queue_input_audio</span>(<span style="color:#999">self</span>, input_audio):
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>queued_input_audio <span style="color:#000;font-weight:bold">=</span> input_audio
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">process_event</span>(<span style="color:#999">self</span>, event, <span style="color:#000;font-weight:bold">*</span>args):
</span></span><span style="display:flex;"><span>        event_processor <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>EventProcessors<span style="color:#000;font-weight:bold">.</span>get(event[<span style="color:#d14">&#39;type&#39;</span>])
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">not</span> event_processor:
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">raise</span> <span style="color:#900;font-weight:bold">Exception</span>(<span style="color:#d14">f</span><span style="color:#d14">&#34;Missing conversation event processor for </span><span style="color:#d14">{</span>event[<span style="color:#d14">&#39;type&#39;</span>]<span style="color:#d14">}</span><span style="color:#d14">&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> event_processor(<span style="color:#999">self</span>, event, <span style="color:#000;font-weight:bold">*</span>args)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">get_item</span>(<span style="color:#999">self</span>, <span style="color:#0086b3">id</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>item_lookup<span style="color:#000;font-weight:bold">.</span>get(<span style="color:#0086b3">id</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">get_items</span>(<span style="color:#999">self</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>items[:]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_process_item_created</span>(<span style="color:#999">self</span>, event):
</span></span><span style="display:flex;"><span>        item <span style="color:#000;font-weight:bold">=</span> event[<span style="color:#d14">&#39;item&#39;</span>]
</span></span><span style="display:flex;"><span>        new_item <span style="color:#000;font-weight:bold">=</span> item<span style="color:#000;font-weight:bold">.</span>copy()
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> new_item[<span style="color:#d14">&#39;id&#39;</span>] <span style="color:#000;font-weight:bold">not</span> <span style="color:#000;font-weight:bold">in</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>item_lookup:
</span></span><span style="display:flex;"><span>            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>item_lookup[new_item[<span style="color:#d14">&#39;id&#39;</span>]] <span style="color:#000;font-weight:bold">=</span> new_item
</span></span><span style="display:flex;"><span>            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>items<span style="color:#000;font-weight:bold">.</span>append(new_item)
</span></span><span style="display:flex;"><span>        new_item[<span style="color:#d14">&#39;formatted&#39;</span>] <span style="color:#000;font-weight:bold">=</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#39;audio&#39;</span>: [],
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#39;text&#39;</span>: <span style="color:#d14">&#39;&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#39;transcript&#39;</span>: <span style="color:#d14">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> new_item[<span style="color:#d14">&#39;id&#39;</span>] <span style="color:#000;font-weight:bold">in</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>queued_speech_items:
</span></span><span style="display:flex;"><span>            new_item[<span style="color:#d14">&#39;formatted&#39;</span>][<span style="color:#d14">&#39;audio&#39;</span>] <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>queued_speech_items[new_item[<span style="color:#d14">&#39;id&#39;</span>]][<span style="color:#d14">&#39;audio&#39;</span>]
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">del</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>queued_speech_items[new_item[<span style="color:#d14">&#39;id&#39;</span>]]
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#d14">&#39;content&#39;</span> <span style="color:#000;font-weight:bold">in</span> new_item:
</span></span><span style="display:flex;"><span>            text_content <span style="color:#000;font-weight:bold">=</span> [c <span style="color:#000;font-weight:bold">for</span> c <span style="color:#000;font-weight:bold">in</span> new_item[<span style="color:#d14">&#39;content&#39;</span>] <span style="color:#000;font-weight:bold">if</span> c[<span style="color:#d14">&#39;type&#39;</span>] <span style="color:#000;font-weight:bold">in</span> [<span style="color:#d14">&#39;text&#39;</span>, <span style="color:#d14">&#39;input_text&#39;</span>]]
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">for</span> content <span style="color:#000;font-weight:bold">in</span> text_content:
</span></span><span style="display:flex;"><span>                new_item[<span style="color:#d14">&#39;formatted&#39;</span>][<span style="color:#d14">&#39;text&#39;</span>] <span style="color:#000;font-weight:bold">+=</span> content[<span style="color:#d14">&#39;text&#39;</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> new_item[<span style="color:#d14">&#39;id&#39;</span>] <span style="color:#000;font-weight:bold">in</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>queued_transcript_items:
</span></span><span style="display:flex;"><span>            new_item[<span style="color:#d14">&#39;formatted&#39;</span>][<span style="color:#d14">&#39;transcript&#39;</span>] <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>queued_transcript_items[new_item[<span style="color:#d14">&#39;id&#39;</span>]][<span style="color:#d14">&#39;transcript&#39;</span>]
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">del</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>queued_transcript_items[new_item[<span style="color:#d14">&#39;id&#39;</span>]]
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> new_item[<span style="color:#d14">&#39;type&#39;</span>] <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#39;message&#39;</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">if</span> new_item[<span style="color:#d14">&#39;role&#39;</span>] <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#39;user&#39;</span>:
</span></span><span style="display:flex;"><span>                new_item[<span style="color:#d14">&#39;status&#39;</span>] <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;completed&#39;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>queued_input_audio:
</span></span><span style="display:flex;"><span>                    new_item[<span style="color:#d14">&#39;formatted&#39;</span>][<span style="color:#d14">&#39;audio&#39;</span>] <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>queued_input_audio
</span></span><span style="display:flex;"><span>                    <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>queued_input_audio <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">None</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>                new_item[<span style="color:#d14">&#39;status&#39;</span>] <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;in_progress&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">elif</span> new_item[<span style="color:#d14">&#39;type&#39;</span>] <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#39;function_call&#39;</span>:
</span></span><span style="display:flex;"><span>            new_item[<span style="color:#d14">&#39;formatted&#39;</span>][<span style="color:#d14">&#39;tool&#39;</span>] <span style="color:#000;font-weight:bold">=</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#d14">&#39;type&#39;</span>: <span style="color:#d14">&#39;function&#39;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#d14">&#39;name&#39;</span>: new_item[<span style="color:#d14">&#39;name&#39;</span>],
</span></span><span style="display:flex;"><span>                <span style="color:#d14">&#39;call_id&#39;</span>: new_item[<span style="color:#d14">&#39;call_id&#39;</span>],
</span></span><span style="display:flex;"><span>                <span style="color:#d14">&#39;arguments&#39;</span>: <span style="color:#d14">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            new_item[<span style="color:#d14">&#39;status&#39;</span>] <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;in_progress&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">elif</span> new_item[<span style="color:#d14">&#39;type&#39;</span>] <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#39;function_call_output&#39;</span>:
</span></span><span style="display:flex;"><span>            new_item[<span style="color:#d14">&#39;status&#39;</span>] <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;completed&#39;</span>
</span></span><span style="display:flex;"><span>            new_item[<span style="color:#d14">&#39;formatted&#39;</span>][<span style="color:#d14">&#39;output&#39;</span>] <span style="color:#000;font-weight:bold">=</span> new_item[<span style="color:#d14">&#39;output&#39;</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> new_item, <span style="color:#000;font-weight:bold">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_process_item_truncated</span>(<span style="color:#999">self</span>, event):
</span></span><span style="display:flex;"><span>        item_id <span style="color:#000;font-weight:bold">=</span> event[<span style="color:#d14">&#39;item_id&#39;</span>]
</span></span><span style="display:flex;"><span>        audio_end_ms <span style="color:#000;font-weight:bold">=</span> event[<span style="color:#d14">&#39;audio_end_ms&#39;</span>]
</span></span><span style="display:flex;"><span>        item <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>item_lookup<span style="color:#000;font-weight:bold">.</span>get(item_id)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">not</span> item:
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">raise</span> <span style="color:#900;font-weight:bold">Exception</span>(<span style="color:#d14">f</span><span style="color:#d14">&#39;item.truncated: Item &#34;</span><span style="color:#d14">{</span>item_id<span style="color:#d14">}</span><span style="color:#d14">&#34; not found&#39;</span>)
</span></span><span style="display:flex;"><span>        end_index <span style="color:#000;font-weight:bold">=</span> (audio_end_ms <span style="color:#000;font-weight:bold">*</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>default_frequency) <span style="color:#000;font-weight:bold">//</span> <span style="color:#099">1000</span>
</span></span><span style="display:flex;"><span>        item[<span style="color:#d14">&#39;formatted&#39;</span>][<span style="color:#d14">&#39;transcript&#39;</span>] <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>        item[<span style="color:#d14">&#39;formatted&#39;</span>][<span style="color:#d14">&#39;audio&#39;</span>] <span style="color:#000;font-weight:bold">=</span> item[<span style="color:#d14">&#39;formatted&#39;</span>][<span style="color:#d14">&#39;audio&#39;</span>][:end_index]
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> item, <span style="color:#000;font-weight:bold">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_process_item_deleted</span>(<span style="color:#999">self</span>, event):
</span></span><span style="display:flex;"><span>        item_id <span style="color:#000;font-weight:bold">=</span> event[<span style="color:#d14">&#39;item_id&#39;</span>]
</span></span><span style="display:flex;"><span>        item <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>item_lookup<span style="color:#000;font-weight:bold">.</span>get(item_id)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">not</span> item:
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">raise</span> <span style="color:#900;font-weight:bold">Exception</span>(<span style="color:#d14">f</span><span style="color:#d14">&#39;item.deleted: Item &#34;</span><span style="color:#d14">{</span>item_id<span style="color:#d14">}</span><span style="color:#d14">&#34; not found&#39;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">del</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>item_lookup[item[<span style="color:#d14">&#39;id&#39;</span>]]
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>items<span style="color:#000;font-weight:bold">.</span>remove(item)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> item, <span style="color:#000;font-weight:bold">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_process_input_audio_transcription_completed</span>(<span style="color:#999">self</span>, event):
</span></span><span style="display:flex;"><span>        item_id <span style="color:#000;font-weight:bold">=</span> event[<span style="color:#d14">&#39;item_id&#39;</span>]
</span></span><span style="display:flex;"><span>        content_index <span style="color:#000;font-weight:bold">=</span> event[<span style="color:#d14">&#39;content_index&#39;</span>]
</span></span><span style="display:flex;"><span>        transcript <span style="color:#000;font-weight:bold">=</span> event[<span style="color:#d14">&#39;transcript&#39;</span>]
</span></span><span style="display:flex;"><span>        formatted_transcript <span style="color:#000;font-weight:bold">=</span> transcript <span style="color:#000;font-weight:bold">or</span> <span style="color:#d14">&#39; &#39;</span>
</span></span><span style="display:flex;"><span>        item <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>item_lookup<span style="color:#000;font-weight:bold">.</span>get(item_id)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">not</span> item:
</span></span><span style="display:flex;"><span>            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>queued_transcript_items[item_id] <span style="color:#000;font-weight:bold">=</span> {<span style="color:#d14">&#39;transcript&#39;</span>: formatted_transcript}
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">None</span>, <span style="color:#000;font-weight:bold">None</span>
</span></span><span style="display:flex;"><span>        item[<span style="color:#d14">&#39;content&#39;</span>][content_index][<span style="color:#d14">&#39;transcript&#39;</span>] <span style="color:#000;font-weight:bold">=</span> transcript
</span></span><span style="display:flex;"><span>        item[<span style="color:#d14">&#39;formatted&#39;</span>][<span style="color:#d14">&#39;transcript&#39;</span>] <span style="color:#000;font-weight:bold">=</span> formatted_transcript
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> item, {<span style="color:#d14">&#39;transcript&#39;</span>: transcript}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_process_speech_started</span>(<span style="color:#999">self</span>, event):
</span></span><span style="display:flex;"><span>        item_id <span style="color:#000;font-weight:bold">=</span> event[<span style="color:#d14">&#39;item_id&#39;</span>]
</span></span><span style="display:flex;"><span>        audio_start_ms <span style="color:#000;font-weight:bold">=</span> event[<span style="color:#d14">&#39;audio_start_ms&#39;</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>queued_speech_items[item_id] <span style="color:#000;font-weight:bold">=</span> {<span style="color:#d14">&#39;audio_start_ms&#39;</span>: audio_start_ms}
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">None</span>, <span style="color:#000;font-weight:bold">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_process_speech_stopped</span>(<span style="color:#999">self</span>, event, input_audio_buffer):
</span></span><span style="display:flex;"><span>        item_id <span style="color:#000;font-weight:bold">=</span> event[<span style="color:#d14">&#39;item_id&#39;</span>]
</span></span><span style="display:flex;"><span>        audio_end_ms <span style="color:#000;font-weight:bold">=</span> event[<span style="color:#d14">&#39;audio_end_ms&#39;</span>]
</span></span><span style="display:flex;"><span>        speech <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>queued_speech_items[item_id]
</span></span><span style="display:flex;"><span>        speech[<span style="color:#d14">&#39;audio_end_ms&#39;</span>] <span style="color:#000;font-weight:bold">=</span> audio_end_ms
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> input_audio_buffer:
</span></span><span style="display:flex;"><span>            start_index <span style="color:#000;font-weight:bold">=</span> (speech[<span style="color:#d14">&#39;audio_start_ms&#39;</span>] <span style="color:#000;font-weight:bold">*</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>default_frequency) <span style="color:#000;font-weight:bold">//</span> <span style="color:#099">1000</span>
</span></span><span style="display:flex;"><span>            end_index <span style="color:#000;font-weight:bold">=</span> (speech[<span style="color:#d14">&#39;audio_end_ms&#39;</span>] <span style="color:#000;font-weight:bold">*</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>default_frequency) <span style="color:#000;font-weight:bold">//</span> <span style="color:#099">1000</span>
</span></span><span style="display:flex;"><span>            speech[<span style="color:#d14">&#39;audio&#39;</span>] <span style="color:#000;font-weight:bold">=</span> input_audio_buffer[start_index:end_index]
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">None</span>, <span style="color:#000;font-weight:bold">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_process_response_created</span>(<span style="color:#999">self</span>, event):
</span></span><span style="display:flex;"><span>        response <span style="color:#000;font-weight:bold">=</span> event[<span style="color:#d14">&#39;response&#39;</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> response[<span style="color:#d14">&#39;id&#39;</span>] <span style="color:#000;font-weight:bold">not</span> <span style="color:#000;font-weight:bold">in</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>response_lookup:
</span></span><span style="display:flex;"><span>            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>response_lookup[response[<span style="color:#d14">&#39;id&#39;</span>]] <span style="color:#000;font-weight:bold">=</span> response
</span></span><span style="display:flex;"><span>            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>responses<span style="color:#000;font-weight:bold">.</span>append(response)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">None</span>, <span style="color:#000;font-weight:bold">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_process_output_item_added</span>(<span style="color:#999">self</span>, event):
</span></span><span style="display:flex;"><span>        response_id <span style="color:#000;font-weight:bold">=</span> event[<span style="color:#d14">&#39;response_id&#39;</span>]
</span></span><span style="display:flex;"><span>        item <span style="color:#000;font-weight:bold">=</span> event[<span style="color:#d14">&#39;item&#39;</span>]
</span></span><span style="display:flex;"><span>        response <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>response_lookup<span style="color:#000;font-weight:bold">.</span>get(response_id)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">not</span> response:
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">raise</span> <span style="color:#900;font-weight:bold">Exception</span>(<span style="color:#d14">f</span><span style="color:#d14">&#39;response.output_item.added: Response &#34;</span><span style="color:#d14">{</span>response_id<span style="color:#d14">}</span><span style="color:#d14">&#34; not found&#39;</span>)
</span></span><span style="display:flex;"><span>        response[<span style="color:#d14">&#39;output&#39;</span>]<span style="color:#000;font-weight:bold">.</span>append(item[<span style="color:#d14">&#39;id&#39;</span>])
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">None</span>, <span style="color:#000;font-weight:bold">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_process_output_item_done</span>(<span style="color:#999">self</span>, event):
</span></span><span style="display:flex;"><span>        item <span style="color:#000;font-weight:bold">=</span> event[<span style="color:#d14">&#39;item&#39;</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">not</span> item:
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">raise</span> <span style="color:#900;font-weight:bold">Exception</span>(<span style="color:#d14">&#39;response.output_item.done: Missing &#34;item&#34;&#39;</span>)
</span></span><span style="display:flex;"><span>        found_item <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>item_lookup<span style="color:#000;font-weight:bold">.</span>get(item[<span style="color:#d14">&#39;id&#39;</span>])
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">not</span> found_item:
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">raise</span> <span style="color:#900;font-weight:bold">Exception</span>(<span style="color:#d14">f</span><span style="color:#d14">&#39;response.output_item.done: Item &#34;</span><span style="color:#d14">{</span>item[<span style="color:#d14">&#34;id&#34;</span>]<span style="color:#d14">}</span><span style="color:#d14">&#34; not found&#39;</span>)
</span></span><span style="display:flex;"><span>        found_item[<span style="color:#d14">&#39;status&#39;</span>] <span style="color:#000;font-weight:bold">=</span> item[<span style="color:#d14">&#39;status&#39;</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> found_item, <span style="color:#000;font-weight:bold">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_process_content_part_added</span>(<span style="color:#999">self</span>, event):
</span></span><span style="display:flex;"><span>        item_id <span style="color:#000;font-weight:bold">=</span> event[<span style="color:#d14">&#39;item_id&#39;</span>]
</span></span><span style="display:flex;"><span>        part <span style="color:#000;font-weight:bold">=</span> event[<span style="color:#d14">&#39;part&#39;</span>]
</span></span><span style="display:flex;"><span>        item <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>item_lookup<span style="color:#000;font-weight:bold">.</span>get(item_id)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">not</span> item:
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">raise</span> <span style="color:#900;font-weight:bold">Exception</span>(<span style="color:#d14">f</span><span style="color:#d14">&#39;response.content_part.added: Item &#34;</span><span style="color:#d14">{</span>item_id<span style="color:#d14">}</span><span style="color:#d14">&#34; not found&#39;</span>)
</span></span><span style="display:flex;"><span>        item[<span style="color:#d14">&#39;content&#39;</span>]<span style="color:#000;font-weight:bold">.</span>append(part)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> item, <span style="color:#000;font-weight:bold">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_process_audio_transcript_delta</span>(<span style="color:#999">self</span>, event):
</span></span><span style="display:flex;"><span>        item_id <span style="color:#000;font-weight:bold">=</span> event[<span style="color:#d14">&#39;item_id&#39;</span>]
</span></span><span style="display:flex;"><span>        content_index <span style="color:#000;font-weight:bold">=</span> event[<span style="color:#d14">&#39;content_index&#39;</span>]
</span></span><span style="display:flex;"><span>        delta <span style="color:#000;font-weight:bold">=</span> event[<span style="color:#d14">&#39;delta&#39;</span>]
</span></span><span style="display:flex;"><span>        item <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>item_lookup<span style="color:#000;font-weight:bold">.</span>get(item_id)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">not</span> item:
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">raise</span> <span style="color:#900;font-weight:bold">Exception</span>(<span style="color:#d14">f</span><span style="color:#d14">&#39;response.audio_transcript.delta: Item &#34;</span><span style="color:#d14">{</span>item_id<span style="color:#d14">}</span><span style="color:#d14">&#34; not found&#39;</span>)
</span></span><span style="display:flex;"><span>        item[<span style="color:#d14">&#39;content&#39;</span>][content_index][<span style="color:#d14">&#39;transcript&#39;</span>] <span style="color:#000;font-weight:bold">+=</span> delta
</span></span><span style="display:flex;"><span>        item[<span style="color:#d14">&#39;formatted&#39;</span>][<span style="color:#d14">&#39;transcript&#39;</span>] <span style="color:#000;font-weight:bold">+=</span> delta
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> item, {<span style="color:#d14">&#39;transcript&#39;</span>: delta}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_process_audio_delta</span>(<span style="color:#999">self</span>, event):
</span></span><span style="display:flex;"><span>        item_id <span style="color:#000;font-weight:bold">=</span> event[<span style="color:#d14">&#39;item_id&#39;</span>]
</span></span><span style="display:flex;"><span>        content_index <span style="color:#000;font-weight:bold">=</span> event[<span style="color:#d14">&#39;content_index&#39;</span>]
</span></span><span style="display:flex;"><span>        delta <span style="color:#000;font-weight:bold">=</span> event[<span style="color:#d14">&#39;delta&#39;</span>]
</span></span><span style="display:flex;"><span>        item <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>item_lookup<span style="color:#000;font-weight:bold">.</span>get(item_id)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">not</span> item:
</span></span><span style="display:flex;"><span>            logger<span style="color:#000;font-weight:bold">.</span>debug(<span style="color:#d14">f</span><span style="color:#d14">&#39;response.audio.delta: Item &#34;</span><span style="color:#d14">{</span>item_id<span style="color:#d14">}</span><span style="color:#d14">&#34; not found&#39;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">None</span>, <span style="color:#000;font-weight:bold">None</span>
</span></span><span style="display:flex;"><span>        array_buffer <span style="color:#000;font-weight:bold">=</span> base64_to_array_buffer(delta)
</span></span><span style="display:flex;"><span>        append_values <span style="color:#000;font-weight:bold">=</span> array_buffer<span style="color:#000;font-weight:bold">.</span>tobytes()
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># TODO: make it work</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># item[&#39;formatted&#39;][&#39;audio&#39;] = merge_int16_arrays(item[&#39;formatted&#39;][&#39;audio&#39;], append_values)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> item, {<span style="color:#d14">&#39;audio&#39;</span>: append_values}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_process_text_delta</span>(<span style="color:#999">self</span>, event):
</span></span><span style="display:flex;"><span>        item_id <span style="color:#000;font-weight:bold">=</span> event[<span style="color:#d14">&#39;item_id&#39;</span>]
</span></span><span style="display:flex;"><span>        content_index <span style="color:#000;font-weight:bold">=</span> event[<span style="color:#d14">&#39;content_index&#39;</span>]
</span></span><span style="display:flex;"><span>        delta <span style="color:#000;font-weight:bold">=</span> event[<span style="color:#d14">&#39;delta&#39;</span>]
</span></span><span style="display:flex;"><span>        item <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>item_lookup<span style="color:#000;font-weight:bold">.</span>get(item_id)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">not</span> item:
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">raise</span> <span style="color:#900;font-weight:bold">Exception</span>(<span style="color:#d14">f</span><span style="color:#d14">&#39;response.text.delta: Item &#34;</span><span style="color:#d14">{</span>item_id<span style="color:#d14">}</span><span style="color:#d14">&#34; not found&#39;</span>)
</span></span><span style="display:flex;"><span>        item[<span style="color:#d14">&#39;content&#39;</span>][content_index][<span style="color:#d14">&#39;text&#39;</span>] <span style="color:#000;font-weight:bold">+=</span> delta
</span></span><span style="display:flex;"><span>        item[<span style="color:#d14">&#39;formatted&#39;</span>][<span style="color:#d14">&#39;text&#39;</span>] <span style="color:#000;font-weight:bold">+=</span> delta
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> item, {<span style="color:#d14">&#39;text&#39;</span>: delta}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_process_function_call_arguments_delta</span>(<span style="color:#999">self</span>, event):
</span></span><span style="display:flex;"><span>        item_id <span style="color:#000;font-weight:bold">=</span> event[<span style="color:#d14">&#39;item_id&#39;</span>]
</span></span><span style="display:flex;"><span>        delta <span style="color:#000;font-weight:bold">=</span> event[<span style="color:#d14">&#39;delta&#39;</span>]
</span></span><span style="display:flex;"><span>        item <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>item_lookup<span style="color:#000;font-weight:bold">.</span>get(item_id)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">not</span> item:
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">raise</span> <span style="color:#900;font-weight:bold">Exception</span>(<span style="color:#d14">f</span><span style="color:#d14">&#39;response.function_call_arguments.delta: Item &#34;</span><span style="color:#d14">{</span>item_id<span style="color:#d14">}</span><span style="color:#d14">&#34; not found&#39;</span>)
</span></span><span style="display:flex;"><span>        item[<span style="color:#d14">&#39;arguments&#39;</span>] <span style="color:#000;font-weight:bold">+=</span> delta
</span></span><span style="display:flex;"><span>        item[<span style="color:#d14">&#39;formatted&#39;</span>][<span style="color:#d14">&#39;tool&#39;</span>][<span style="color:#d14">&#39;arguments&#39;</span>] <span style="color:#000;font-weight:bold">+=</span> delta
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> item, {<span style="color:#d14">&#39;arguments&#39;</span>: delta}
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="实时客户端类">实时客户端类</h5>
<ul>
<li>初始化：设置系统提示、会话配置，并初始化 RealtimeAPI 和 RealtimeConversation，用于管理 WebSocket 连接和会话事件。</li>
<li>连接管理：负责与服务器建立和断开连接、等待会话创建以及更新会话设置。</li>
<li>事件处理：监听并处理服务器和客户端事件，并将它们分发给相应的处理程序。</li>
<li>会话管理：管理会话项的创建、更新和删除，包括处理输入音频和语音事件。</li>
<li>工具与响应管理：支持添加/删除工具、根据事件调用工具、向用户发送消息、创建响应以及管理音频内容。</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">150
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">151
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">152
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">153
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">154
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">155
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">156
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">157
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">158
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">159
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">160
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">161
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">162
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">163
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">164
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">165
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">166
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">167
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">168
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">169
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">170
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">171
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">172
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">173
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">174
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">175
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">176
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">177
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">178
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">179
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">180
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">181
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">182
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">183
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">184
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">185
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">186
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">187
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">188
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">189
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">190
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">191
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">192
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">193
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">194
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">195
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">196
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">197
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">198
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">199
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">200
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">201
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">202
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">203
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">204
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">205
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">206
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">207
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">208
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">209
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">210
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">211
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">212
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">213
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">214
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">215
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">216
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">217
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">218
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">219
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">220
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">221
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">222
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">223
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">224
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">225
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">226
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">227
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">228
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">229
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">230
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">231
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">232
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">233
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">234
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">235
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">236
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">237
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">238
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">239
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">240
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">241
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">242
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">243
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">244
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">245
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">246
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">247
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">248
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">249
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">250
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">251
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">252
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">253
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">254
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">255
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">RealtimeClient</span>(RealtimeEventHandler):
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> __init__(<span style="color:#999">self</span>, system_prompt: <span style="color:#0086b3">str</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#0086b3">super</span>()<span style="color:#000;font-weight:bold">.</span>__init__()
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>system_prompt <span style="color:#000;font-weight:bold">=</span> system_prompt
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>default_session_config <span style="color:#000;font-weight:bold">=</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#34;modalities&#34;</span>: [<span style="color:#d14">&#34;text&#34;</span>, <span style="color:#d14">&#34;audio&#34;</span>],
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#34;instructions&#34;</span>: <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>system_prompt,
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#34;voice&#34;</span>: <span style="color:#d14">&#34;shimmer&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#34;input_audio_format&#34;</span>: <span style="color:#d14">&#34;pcm16&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#34;output_audio_format&#34;</span>: <span style="color:#d14">&#34;pcm16&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#34;input_audio_transcription&#34;</span>: { <span style="color:#d14">&#34;model&#34;</span>: <span style="color:#d14">&#39;whisper-1&#39;</span> },
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#34;turn_detection&#34;</span>: { <span style="color:#d14">&#34;type&#34;</span>: <span style="color:#d14">&#39;server_vad&#39;</span> },
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#34;tools&#34;</span>: [],
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#34;tool_choice&#34;</span>: <span style="color:#d14">&#34;auto&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#34;temperature&#34;</span>: <span style="color:#099">0.8</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#34;max_response_output_tokens&#34;</span>: <span style="color:#099">4096</span>,
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>session_config <span style="color:#000;font-weight:bold">=</span> {}
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>transcription_models <span style="color:#000;font-weight:bold">=</span> [{<span style="color:#d14">&#34;model&#34;</span>: <span style="color:#d14">&#34;whisper-1&#34;</span>}]
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>default_server_vad_config <span style="color:#000;font-weight:bold">=</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#34;type&#34;</span>: <span style="color:#d14">&#34;server_vad&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#34;threshold&#34;</span>: <span style="color:#099">0.5</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#34;prefix_padding_ms&#34;</span>: <span style="color:#099">300</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#34;silence_duration_ms&#34;</span>: <span style="color:#099">200</span>,
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>realtime <span style="color:#000;font-weight:bold">=</span> RealtimeAPI()
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>conversation <span style="color:#000;font-weight:bold">=</span> RealtimeConversation()
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_reset_config()
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_add_api_event_handlers()
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_reset_config</span>(<span style="color:#999">self</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>session_created <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>tools <span style="color:#000;font-weight:bold">=</span> {}
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>session_config <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>default_session_config<span style="color:#000;font-weight:bold">.</span>copy()
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>input_audio_buffer <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">bytearray</span>()
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_add_api_event_handlers</span>(<span style="color:#999">self</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>realtime<span style="color:#000;font-weight:bold">.</span>on(<span style="color:#d14">&#34;client.*&#34;</span>, <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_log_event)
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>realtime<span style="color:#000;font-weight:bold">.</span>on(<span style="color:#d14">&#34;server.*&#34;</span>, <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_log_event)
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>realtime<span style="color:#000;font-weight:bold">.</span>on(<span style="color:#d14">&#34;server.session.created&#34;</span>, <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_on_session_created)
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>realtime<span style="color:#000;font-weight:bold">.</span>on(<span style="color:#d14">&#34;server.response.created&#34;</span>, <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_process_event)
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>realtime<span style="color:#000;font-weight:bold">.</span>on(<span style="color:#d14">&#34;server.response.output_item.added&#34;</span>, <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_process_event)
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>realtime<span style="color:#000;font-weight:bold">.</span>on(<span style="color:#d14">&#34;server.response.content_part.added&#34;</span>, <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_process_event)
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>realtime<span style="color:#000;font-weight:bold">.</span>on(<span style="color:#d14">&#34;server.input_audio_buffer.speech_started&#34;</span>, <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_on_speech_started)
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>realtime<span style="color:#000;font-weight:bold">.</span>on(<span style="color:#d14">&#34;server.input_audio_buffer.speech_stopped&#34;</span>, <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_on_speech_stopped)
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>realtime<span style="color:#000;font-weight:bold">.</span>on(<span style="color:#d14">&#34;server.conversation.item.created&#34;</span>, <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_on_item_created)
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>realtime<span style="color:#000;font-weight:bold">.</span>on(<span style="color:#d14">&#34;server.conversation.item.truncated&#34;</span>, <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_process_event)
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>realtime<span style="color:#000;font-weight:bold">.</span>on(<span style="color:#d14">&#34;server.conversation.item.deleted&#34;</span>, <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_process_event)
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>realtime<span style="color:#000;font-weight:bold">.</span>on(<span style="color:#d14">&#34;server.conversation.item.input_audio_transcription.completed&#34;</span>, <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_process_event)
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>realtime<span style="color:#000;font-weight:bold">.</span>on(<span style="color:#d14">&#34;server.response.audio_transcript.delta&#34;</span>, <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_process_event)
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>realtime<span style="color:#000;font-weight:bold">.</span>on(<span style="color:#d14">&#34;server.response.audio.delta&#34;</span>, <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_process_event)
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>realtime<span style="color:#000;font-weight:bold">.</span>on(<span style="color:#d14">&#34;server.response.text.delta&#34;</span>, <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_process_event)
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>realtime<span style="color:#000;font-weight:bold">.</span>on(<span style="color:#d14">&#34;server.response.function_call_arguments.delta&#34;</span>, <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_process_event)
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>realtime<span style="color:#000;font-weight:bold">.</span>on(<span style="color:#d14">&#34;server.response.output_item.done&#34;</span>, <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_on_output_item_done)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_log_event</span>(<span style="color:#999">self</span>, event):
</span></span><span style="display:flex;"><span>        realtime_event <span style="color:#000;font-weight:bold">=</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#34;time&#34;</span>: datetime<span style="color:#000;font-weight:bold">.</span>utcnow()<span style="color:#000;font-weight:bold">.</span>isoformat(),
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#34;source&#34;</span>: <span style="color:#d14">&#34;client&#34;</span> <span style="color:#000;font-weight:bold">if</span> event[<span style="color:#d14">&#34;type&#34;</span>]<span style="color:#000;font-weight:bold">.</span>startswith(<span style="color:#d14">&#34;client.&#34;</span>) <span style="color:#000;font-weight:bold">else</span> <span style="color:#d14">&#34;server&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#34;event&#34;</span>: event,
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>dispatch(<span style="color:#d14">&#34;realtime.event&#34;</span>, realtime_event)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_on_session_created</span>(<span style="color:#999">self</span>, event):
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>session_created <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_process_event</span>(<span style="color:#999">self</span>, event, <span style="color:#000;font-weight:bold">*</span>args):
</span></span><span style="display:flex;"><span>        item, delta <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>conversation<span style="color:#000;font-weight:bold">.</span>process_event(event, <span style="color:#000;font-weight:bold">*</span>args)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> item:
</span></span><span style="display:flex;"><span>            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>dispatch(<span style="color:#d14">&#34;conversation.updated&#34;</span>, {<span style="color:#d14">&#34;item&#34;</span>: item, <span style="color:#d14">&#34;delta&#34;</span>: delta})
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> item, delta
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_on_speech_started</span>(<span style="color:#999">self</span>, event):
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_process_event(event)
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>dispatch(<span style="color:#d14">&#34;conversation.interrupted&#34;</span>, event)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_on_speech_stopped</span>(<span style="color:#999">self</span>, event):
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_process_event(event, <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>input_audio_buffer)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_on_item_created</span>(<span style="color:#999">self</span>, event):
</span></span><span style="display:flex;"><span>        item, delta <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_process_event(event)
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>dispatch(<span style="color:#d14">&#34;conversation.item.appended&#34;</span>, {<span style="color:#d14">&#34;item&#34;</span>: item})
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> item <span style="color:#000;font-weight:bold">and</span> item[<span style="color:#d14">&#34;status&#34;</span>] <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#34;completed&#34;</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>dispatch(<span style="color:#d14">&#34;conversation.item.completed&#34;</span>, {<span style="color:#d14">&#34;item&#34;</span>: item})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">async</span> <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_on_output_item_done</span>(<span style="color:#999">self</span>, event):
</span></span><span style="display:flex;"><span>        item, delta <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_process_event(event)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> item <span style="color:#000;font-weight:bold">and</span> item[<span style="color:#d14">&#34;status&#34;</span>] <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#34;completed&#34;</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>dispatch(<span style="color:#d14">&#34;conversation.item.completed&#34;</span>, {<span style="color:#d14">&#34;item&#34;</span>: item})
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> item <span style="color:#000;font-weight:bold">and</span> item<span style="color:#000;font-weight:bold">.</span>get(<span style="color:#d14">&#34;formatted&#34;</span>, {})<span style="color:#000;font-weight:bold">.</span>get(<span style="color:#d14">&#34;tool&#34;</span>):
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">await</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_call_tool(item[<span style="color:#d14">&#34;formatted&#34;</span>][<span style="color:#d14">&#34;tool&#34;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">async</span> <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_call_tool</span>(<span style="color:#999">self</span>, tool):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">try</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#0086b3">print</span>(tool[<span style="color:#d14">&#34;arguments&#34;</span>])
</span></span><span style="display:flex;"><span>            json_arguments <span style="color:#000;font-weight:bold">=</span> json<span style="color:#000;font-weight:bold">.</span>loads(tool[<span style="color:#d14">&#34;arguments&#34;</span>])
</span></span><span style="display:flex;"><span>            tool_config <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>tools<span style="color:#000;font-weight:bold">.</span>get(tool[<span style="color:#d14">&#34;name&#34;</span>])
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">not</span> tool_config:
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">raise</span> <span style="color:#900;font-weight:bold">Exception</span>(<span style="color:#d14">f</span><span style="color:#d14">&#39;Tool &#34;</span><span style="color:#d14">{</span>tool[<span style="color:#d14">&#34;name&#34;</span>]<span style="color:#d14">}</span><span style="color:#d14">&#34; has not been added&#39;</span>)
</span></span><span style="display:flex;"><span>            result <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">await</span> tool_config[<span style="color:#d14">&#34;handler&#34;</span>](<span style="color:#000;font-weight:bold">**</span>json_arguments)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">await</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>realtime<span style="color:#000;font-weight:bold">.</span>send(<span style="color:#d14">&#34;conversation.item.create&#34;</span>, {
</span></span><span style="display:flex;"><span>                <span style="color:#d14">&#34;item&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#d14">&#34;type&#34;</span>: <span style="color:#d14">&#34;function_call_output&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#d14">&#34;call_id&#34;</span>: tool[<span style="color:#d14">&#34;call_id&#34;</span>],
</span></span><span style="display:flex;"><span>                    <span style="color:#d14">&#34;output&#34;</span>: json<span style="color:#000;font-weight:bold">.</span>dumps(result),
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            })
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">except</span> <span style="color:#900;font-weight:bold">Exception</span> <span style="color:#000;font-weight:bold">as</span> e:
</span></span><span style="display:flex;"><span>            logger<span style="color:#000;font-weight:bold">.</span>error(traceback<span style="color:#000;font-weight:bold">.</span>format_exc())
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">await</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>realtime<span style="color:#000;font-weight:bold">.</span>send(<span style="color:#d14">&#34;conversation.item.create&#34;</span>, {
</span></span><span style="display:flex;"><span>                <span style="color:#d14">&#34;item&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#d14">&#34;type&#34;</span>: <span style="color:#d14">&#34;function_call_output&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#d14">&#34;call_id&#34;</span>: tool[<span style="color:#d14">&#34;call_id&#34;</span>],
</span></span><span style="display:flex;"><span>                    <span style="color:#d14">&#34;output&#34;</span>: json<span style="color:#000;font-weight:bold">.</span>dumps({<span style="color:#d14">&#34;error&#34;</span>: <span style="color:#0086b3">str</span>(e)}),
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            })
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">await</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>create_response()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">is_connected</span>(<span style="color:#999">self</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>realtime<span style="color:#000;font-weight:bold">.</span>is_connected()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">reset</span>(<span style="color:#999">self</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>disconnect()
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>realtime<span style="color:#000;font-weight:bold">.</span>clear_event_handlers()
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_reset_config()
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_add_api_event_handlers()
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">async</span> <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">connect</span>(<span style="color:#999">self</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>is_connected():
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">raise</span> <span style="color:#900;font-weight:bold">Exception</span>(<span style="color:#d14">&#34;Already connected, use .disconnect() first&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">await</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>realtime<span style="color:#000;font-weight:bold">.</span>connect()
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">await</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>update_session()
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">async</span> <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">wait_for_session_created</span>(<span style="color:#999">self</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">not</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>is_connected():
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">raise</span> <span style="color:#900;font-weight:bold">Exception</span>(<span style="color:#d14">&#34;Not connected, use .connect() first&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">while</span> <span style="color:#000;font-weight:bold">not</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>session_created:
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">await</span> asyncio<span style="color:#000;font-weight:bold">.</span>sleep(<span style="color:#099">0.001</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">async</span> <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">disconnect</span>(<span style="color:#999">self</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>session_created <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>conversation<span style="color:#000;font-weight:bold">.</span>clear()
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>realtime<span style="color:#000;font-weight:bold">.</span>is_connected():
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">await</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>realtime<span style="color:#000;font-weight:bold">.</span>disconnect()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">get_turn_detection_type</span>(<span style="color:#999">self</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>session_config<span style="color:#000;font-weight:bold">.</span>get(<span style="color:#d14">&#34;turn_detection&#34;</span>, {})<span style="color:#000;font-weight:bold">.</span>get(<span style="color:#d14">&#34;type&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">async</span> <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">add_tool</span>(<span style="color:#999">self</span>, definition, handler):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">not</span> definition<span style="color:#000;font-weight:bold">.</span>get(<span style="color:#d14">&#34;name&#34;</span>):
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">raise</span> <span style="color:#900;font-weight:bold">Exception</span>(<span style="color:#d14">&#34;Missing tool name in definition&#34;</span>)
</span></span><span style="display:flex;"><span>        name <span style="color:#000;font-weight:bold">=</span> definition[<span style="color:#d14">&#34;name&#34;</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> name <span style="color:#000;font-weight:bold">in</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>tools:
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">raise</span> <span style="color:#900;font-weight:bold">Exception</span>(<span style="color:#d14">f</span><span style="color:#d14">&#39;Tool &#34;</span><span style="color:#d14">{</span>name<span style="color:#d14">}</span><span style="color:#d14">&#34; already added. Please use .removeTool(&#34;</span><span style="color:#d14">{</span>name<span style="color:#d14">}</span><span style="color:#d14">&#34;) before trying to add again.&#39;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">not</span> callable(handler):
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">raise</span> <span style="color:#900;font-weight:bold">Exception</span>(<span style="color:#d14">f</span><span style="color:#d14">&#39;Tool &#34;</span><span style="color:#d14">{</span>name<span style="color:#d14">}</span><span style="color:#d14">&#34; handler must be a function&#39;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>tools[name] <span style="color:#000;font-weight:bold">=</span> {<span style="color:#d14">&#34;definition&#34;</span>: definition, <span style="color:#d14">&#34;handler&#34;</span>: handler}
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">await</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>update_session()
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>tools[name]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">remove_tool</span>(<span style="color:#999">self</span>, name):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> name <span style="color:#000;font-weight:bold">not</span> <span style="color:#000;font-weight:bold">in</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>tools:
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">raise</span> <span style="color:#900;font-weight:bold">Exception</span>(<span style="color:#d14">f</span><span style="color:#d14">&#39;Tool &#34;</span><span style="color:#d14">{</span>name<span style="color:#d14">}</span><span style="color:#d14">&#34; does not exist, can not be removed.&#39;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">del</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>tools[name]
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">async</span> <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">delete_item</span>(<span style="color:#999">self</span>, <span style="color:#0086b3">id</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">await</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>realtime<span style="color:#000;font-weight:bold">.</span>send(<span style="color:#d14">&#34;conversation.item.delete&#34;</span>, {<span style="color:#d14">&#34;item_id&#34;</span>: <span style="color:#0086b3">id</span>})
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">async</span> <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">update_session</span>(<span style="color:#999">self</span>, <span style="color:#000;font-weight:bold">**</span>kwargs):
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>session_config<span style="color:#000;font-weight:bold">.</span>update(kwargs)
</span></span><span style="display:flex;"><span>        use_tools <span style="color:#000;font-weight:bold">=</span> [
</span></span><span style="display:flex;"><span>            {<span style="color:#000;font-weight:bold">**</span>tool_definition, <span style="color:#d14">&#34;type&#34;</span>: <span style="color:#d14">&#34;function&#34;</span>}
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">for</span> tool_definition <span style="color:#000;font-weight:bold">in</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>session_config<span style="color:#000;font-weight:bold">.</span>get(<span style="color:#d14">&#34;tools&#34;</span>, [])
</span></span><span style="display:flex;"><span>        ] <span style="color:#000;font-weight:bold">+</span> [
</span></span><span style="display:flex;"><span>            {<span style="color:#000;font-weight:bold">**</span><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>tools[key][<span style="color:#d14">&#34;definition&#34;</span>], <span style="color:#d14">&#34;type&#34;</span>: <span style="color:#d14">&#34;function&#34;</span>}
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">for</span> key <span style="color:#000;font-weight:bold">in</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>tools
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>        session <span style="color:#000;font-weight:bold">=</span> {<span style="color:#000;font-weight:bold">**</span><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>session_config, <span style="color:#d14">&#34;tools&#34;</span>: use_tools}
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>realtime<span style="color:#000;font-weight:bold">.</span>is_connected():
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">await</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>realtime<span style="color:#000;font-weight:bold">.</span>send(<span style="color:#d14">&#34;session.update&#34;</span>, {<span style="color:#d14">&#34;session&#34;</span>: session})
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">async</span> <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">create_conversation_item</span>(<span style="color:#999">self</span>, item):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">await</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>realtime<span style="color:#000;font-weight:bold">.</span>send(<span style="color:#d14">&#34;conversation.item.create&#34;</span>, {
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#34;item&#34;</span>: item
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">async</span> <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">send_user_message_content</span>(<span style="color:#999">self</span>, content<span style="color:#000;font-weight:bold">=</span>[]):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> content:
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">for</span> c <span style="color:#000;font-weight:bold">in</span> content:
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">if</span> c[<span style="color:#d14">&#34;type&#34;</span>] <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#34;input_audio&#34;</span>:
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">if</span> <span style="color:#0086b3">isinstance</span>(c[<span style="color:#d14">&#34;audio&#34;</span>], (<span style="color:#0086b3">bytes</span>, <span style="color:#0086b3">bytearray</span>)):
</span></span><span style="display:flex;"><span>                        c[<span style="color:#d14">&#34;audio&#34;</span>] <span style="color:#000;font-weight:bold">=</span> array_buffer_to_base64(c[<span style="color:#d14">&#34;audio&#34;</span>])
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">await</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>realtime<span style="color:#000;font-weight:bold">.</span>send(<span style="color:#d14">&#34;conversation.item.create&#34;</span>, {
</span></span><span style="display:flex;"><span>                <span style="color:#d14">&#34;item&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#d14">&#34;type&#34;</span>: <span style="color:#d14">&#34;message&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#d14">&#34;role&#34;</span>: <span style="color:#d14">&#34;user&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#d14">&#34;content&#34;</span>: content,
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            })
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">await</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>create_response()
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">async</span> <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">append_input_audio</span>(<span style="color:#999">self</span>, array_buffer):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#0086b3">len</span>(array_buffer) <span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#099">0</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">await</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>realtime<span style="color:#000;font-weight:bold">.</span>send(<span style="color:#d14">&#34;input_audio_buffer.append&#34;</span>, {
</span></span><span style="display:flex;"><span>                <span style="color:#d14">&#34;audio&#34;</span>: array_buffer_to_base64(np<span style="color:#000;font-weight:bold">.</span>array(array_buffer)),
</span></span><span style="display:flex;"><span>            })
</span></span><span style="display:flex;"><span>            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>input_audio_buffer<span style="color:#000;font-weight:bold">.</span>extend(array_buffer)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">async</span> <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">create_response</span>(<span style="color:#999">self</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>get_turn_detection_type() <span style="color:#000;font-weight:bold">is</span> <span style="color:#000;font-weight:bold">None</span> <span style="color:#000;font-weight:bold">and</span> <span style="color:#0086b3">len</span>(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>input_audio_buffer) <span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#099">0</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">await</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>realtime<span style="color:#000;font-weight:bold">.</span>send(<span style="color:#d14">&#34;input_audio_buffer.commit&#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>conversation<span style="color:#000;font-weight:bold">.</span>queue_input_audio(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>input_audio_buffer)
</span></span><span style="display:flex;"><span>            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>input_audio_buffer <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">bytearray</span>()
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">await</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>realtime<span style="color:#000;font-weight:bold">.</span>send(<span style="color:#d14">&#34;response.create&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">async</span> <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">cancel_response</span>(<span style="color:#999">self</span>, <span style="color:#0086b3">id</span><span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">None</span>, sample_count<span style="color:#000;font-weight:bold">=</span><span style="color:#099">0</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">not</span> <span style="color:#0086b3">id</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">await</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>realtime<span style="color:#000;font-weight:bold">.</span>send(<span style="color:#d14">&#34;response.cancel&#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">return</span> {<span style="color:#d14">&#34;item&#34;</span>: <span style="color:#000;font-weight:bold">None</span>}
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>            item <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>conversation<span style="color:#000;font-weight:bold">.</span>get_item(<span style="color:#0086b3">id</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">not</span> item:
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">raise</span> <span style="color:#900;font-weight:bold">Exception</span>(<span style="color:#d14">f</span><span style="color:#d14">&#39;Could not find item &#34;</span><span style="color:#d14">{</span><span style="color:#0086b3">id</span><span style="color:#d14">}</span><span style="color:#d14">&#34;&#39;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">if</span> item[<span style="color:#d14">&#34;type&#34;</span>] <span style="color:#000;font-weight:bold">!=</span> <span style="color:#d14">&#34;message&#34;</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">raise</span> <span style="color:#900;font-weight:bold">Exception</span>(<span style="color:#d14">&#39;Can only cancelResponse messages with type &#34;message&#34;&#39;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">if</span> item[<span style="color:#d14">&#34;role&#34;</span>] <span style="color:#000;font-weight:bold">!=</span> <span style="color:#d14">&#34;assistant&#34;</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">raise</span> <span style="color:#900;font-weight:bold">Exception</span>(<span style="color:#d14">&#39;Can only cancelResponse messages with role &#34;assistant&#34;&#39;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">await</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>realtime<span style="color:#000;font-weight:bold">.</span>send(<span style="color:#d14">&#34;response.cancel&#34;</span>)
</span></span><span style="display:flex;"><span>            audio_index <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">next</span>((i <span style="color:#000;font-weight:bold">for</span> i, c <span style="color:#000;font-weight:bold">in</span> <span style="color:#0086b3">enumerate</span>(item[<span style="color:#d14">&#34;content&#34;</span>]) <span style="color:#000;font-weight:bold">if</span> c[<span style="color:#d14">&#34;type&#34;</span>] <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#34;audio&#34;</span>), <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">if</span> audio_index <span style="color:#000;font-weight:bold">==</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">raise</span> <span style="color:#900;font-weight:bold">Exception</span>(<span style="color:#d14">&#34;Could not find audio on item to cancel&#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">await</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>realtime<span style="color:#000;font-weight:bold">.</span>send(<span style="color:#d14">&#34;conversation.item.truncate&#34;</span>, {
</span></span><span style="display:flex;"><span>                <span style="color:#d14">&#34;item_id&#34;</span>: <span style="color:#0086b3">id</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#d14">&#34;content_index&#34;</span>: audio_index,
</span></span><span style="display:flex;"><span>                <span style="color:#d14">&#34;audio_end_ms&#34;</span>: <span style="color:#0086b3">int</span>((sample_count <span style="color:#000;font-weight:bold">/</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>conversation<span style="color:#000;font-weight:bold">.</span>default_frequency) <span style="color:#000;font-weight:bold">*</span> <span style="color:#099">1000</span>),
</span></span><span style="display:flex;"><span>            })
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">return</span> {<span style="color:#d14">&#34;item&#34;</span>: item}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">async</span> <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">wait_for_next_item</span>(<span style="color:#999">self</span>):
</span></span><span style="display:flex;"><span>        event <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">await</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>wait_for_next(<span style="color:#d14">&#34;conversation.item.appended&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> {<span style="color:#d14">&#34;item&#34;</span>: event[<span style="color:#d14">&#34;item&#34;</span>]}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">async</span> <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">wait_for_next_completed_item</span>(<span style="color:#999">self</span>):
</span></span><span style="display:flex;"><span>        event <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">await</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>wait_for_next(<span style="color:#d14">&#34;conversation.item.completed&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> {<span style="color:#d14">&#34;item&#34;</span>: event[<span style="color:#d14">&#34;item&#34;</span>]}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="添加工具和处理程序">添加工具和处理程序</h3>
<p>你的语音机器人的功能可以通过集成各种工具和处理程序来扩展。这些工具和处理程序允许机器人根据用户输入执行特定操作。</p>
<ol>
<li>
<p>定义工具定义：</p>
<ul>
<li>在 tool.py 中，定义你的机器人的功能，例如检查订单状态、处理退货或更新账户信息等。</li>
<li>每个工具都有一个名称、描述和所需参数。</li>
</ul>
</li>
<li>
<p>实现处理程序:</p>
<ul>
<li>为每个工具创建异步处理函数，以执行所需的操作。</li>
<li>这些处理程序与后端系统或数据库交互，以满足用户请求。</li>
</ul>
</li>
<li>
<p>将工具集成到实时客户端中：</p>
<ul>
<li>在 app.py 文件中将每个工具及其操作员与 RealtimeClient 进行注册。</li>
<li>确保该机器人在对话中能够动态地调用这些工具。</li>
</ul>
</li>
</ol>
<h4 id="关键组件-1">关键组件</h4>
<h5 id="工具定义">工具定义</h5>
<p>对每个工具进行结构化的描述，包括所需的参数和功能。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Function Definitions</span>
</span></span><span style="display:flex;"><span>check_order_status_def <span style="color:#000;font-weight:bold">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;name&#34;</span>: <span style="color:#d14">&#34;check_order_status&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;description&#34;</span>: <span style="color:#d14">&#34;Check the status of a customer&#39;s order&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;parameters&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#d14">&#34;type&#34;</span>: <span style="color:#d14">&#34;object&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#d14">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#d14">&#34;customer_id&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#d14">&#34;type&#34;</span>: <span style="color:#d14">&#34;string&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#d14">&#34;description&#34;</span>: <span style="color:#d14">&#34;The unique identifier for the customer&#34;</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#d14">&#34;order_id&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#d14">&#34;type&#34;</span>: <span style="color:#d14">&#34;string&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#d14">&#34;description&#34;</span>: <span style="color:#d14">&#34;The unique identifier for the order&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#d14">&#34;required&#34;</span>: [<span style="color:#d14">&#34;customer_id&#34;</span>, <span style="color:#d14">&#34;order_id&#34;</span>]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="处理程序功能">处理程序功能</h5>
<ul>
<li>异步函数，用于执行每个工具的逻辑操作。</li>
<li>与外部系统、数据库进行交互，或根据用户请求执行特定操作。</li>
</ul>
<p>参考: <a href="https://github.com/monuminu/AOAI_Samples/blob/main/realtime-assistant-support/realtime/tools.py">tool.py</a></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">async</span> <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">check_order_status_handler</span>(customer_id, order_id):
</span></span><span style="display:flex;"><span>    status <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;In Transit&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic"># Your Business Logic</span>
</span></span><span style="display:flex;"><span>    estimated_delivery, status, order_date <span style="color:#000;font-weight:bold">=</span>  fetch_order_details(order_id, customer_id)
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic"># Read the HTML template</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">with</span> <span style="color:#0086b3">open</span>(<span style="color:#d14">&#39;order_status_template.html&#39;</span>, <span style="color:#d14">&#39;r&#39;</span>) <span style="color:#000;font-weight:bold">as</span> file:
</span></span><span style="display:flex;"><span>        html_content <span style="color:#000;font-weight:bold">=</span> file<span style="color:#000;font-weight:bold">.</span>read()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic"># Replace placeholders with actual data</span>
</span></span><span style="display:flex;"><span>    html_content <span style="color:#000;font-weight:bold">=</span> html_content<span style="color:#000;font-weight:bold">.</span>format(
</span></span><span style="display:flex;"><span>        order_id<span style="color:#000;font-weight:bold">=</span>order_id,
</span></span><span style="display:flex;"><span>        customer_id<span style="color:#000;font-weight:bold">=</span>customer_id,
</span></span><span style="display:flex;"><span>        order_date<span style="color:#000;font-weight:bold">=</span>order_date<span style="color:#000;font-weight:bold">.</span>strftime(<span style="color:#d14">&#34;%B </span><span style="color:#d14">%d</span><span style="color:#d14">, %Y&#34;</span>),
</span></span><span style="display:flex;"><span>        estimated_delivery<span style="color:#000;font-weight:bold">=</span>estimated_delivery<span style="color:#000;font-weight:bold">.</span>strftime(<span style="color:#d14">&#34;%B </span><span style="color:#d14">%d</span><span style="color:#d14">, %Y&#34;</span>),
</span></span><span style="display:flex;"><span>        status<span style="color:#000;font-weight:bold">=</span>status
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic"># Return the Chainlit message with HTML content</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">await</span> cl<span style="color:#000;font-weight:bold">.</span>Message(content<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">f</span><span style="color:#d14">&#34;Here is the detail of your order </span><span style="color:#d14">\n</span><span style="color:#d14"> </span><span style="color:#d14">{</span>html_content<span style="color:#d14">}</span><span style="color:#d14">&#34;</span>)<span style="color:#000;font-weight:bold">.</span>send()
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> <span style="color:#d14">f</span><span style="color:#d14">&#34;Order </span><span style="color:#d14">{</span>order_id<span style="color:#d14">}</span><span style="color:#d14"> status for customer </span><span style="color:#d14">{</span>customer_id<span style="color:#d14">}</span><span style="color:#d14">: </span><span style="color:#d14">{</span>status<span style="color:#d14">}</span><span style="color:#d14">&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="与应用程序集成">与应用程序集成</h3>
<p>有了实时客户端和相关工具后，是时候将所有内容整合到应用程序中了。</p>
<ol>
<li>
<p>初始化实时 OpenAI：</p>
<ul>
<li>在 app.py 中，使用系统提示和会话配置设置与 GPT-4o 实时 API 的连接。</li>
<li>无缝管理用户会话并跟踪交互。</li>
</ul>
</li>
<li>
<p>处理用户交互：</p>
<ul>
<li>实现聊天启动、消息接收、音频处理和会话终止的事件处理程序。</li>
<li>确保用户输入（无论是文本还是语音）能够得到及时的处理和响应。</li>
</ul>
</li>
<li>
<p>管理对话流程：</p>
<ul>
<li>使用 RealtimeConversation 类来处理会话状态、管理音频流并保持上下文。</li>
<li>实现逻辑以处理中断、取消和基于用户操作的动态响应。</li>
</ul>
</li>
</ol>
<h4 id="关键组件-2">关键组件</h4>
<h5 id="初始化">初始化</h5>
<p>使用系统提示安装OpenAI实时客户端并配置工具。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>system_prompt <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;&#34;&#34;Provide helpful and empathetic support responses to customer inquiries for ShopMe in Hindi language, addressing their requests, concerns, or feedback professionally.
</span></span></span><span style="display:flex;"><span><span style="color:#d14">
</span></span></span><span style="display:flex;"><span><span style="color:#d14">Maintain a friendly and service-oriented tone throughout the interaction to ensure a positive customer experience.
</span></span></span><span style="display:flex;"><span><span style="color:#d14">
</span></span></span><span style="display:flex;"><span><span style="color:#d14"># Steps
</span></span></span><span style="display:flex;"><span><span style="color:#d14">
</span></span></span><span style="display:flex;"><span><span style="color:#d14">1. **Identify the Issue:** Carefully read the customer&#39;s inquiry to understand the problem or question they are presenting.
</span></span></span><span style="display:flex;"><span><span style="color:#d14">2. **Gather Relevant Information:** Check for any additional data needed, such as order numbers or account details, while ensuring the privacy and security of the customer&#39;s information.
</span></span></span><span style="display:flex;"><span><span style="color:#d14">3. **Formulate a Response:** Develop a solution or informative response based on the understanding of the issue. The response should be clear, concise, and address all parts of the customer&#39;s concern.
</span></span></span><span style="display:flex;"><span><span style="color:#d14">4. **Offer Further Assistance:** Invite the customer to reach out again if they need more help or have additional questions.
</span></span></span><span style="display:flex;"><span><span style="color:#d14">5. **Close Politely:** End the conversation with a polite closing statement that reinforces the service commitment of ShopMe.
</span></span></span><span style="display:flex;"><span><span style="color:#d14">
</span></span></span><span style="display:flex;"><span><span style="color:#d14"># Output Format
</span></span></span><span style="display:flex;"><span><span style="color:#d14">
</span></span></span><span style="display:flex;"><span><span style="color:#d14">Provide a clear and concise paragraph addressing the customer&#39;s inquiry, including:
</span></span></span><span style="display:flex;"><span><span style="color:#d14">- Acknowledgment of their concern
</span></span></span><span style="display:flex;"><span><span style="color:#d14">- Suggested solution or response
</span></span></span><span style="display:flex;"><span><span style="color:#d14">- Offer for further assistance
</span></span></span><span style="display:flex;"><span><span style="color:#d14">- Polite closing
</span></span></span><span style="display:flex;"><span><span style="color:#d14">
</span></span></span><span style="display:flex;"><span><span style="color:#d14"># Notes
</span></span></span><span style="display:flex;"><span><span style="color:#d14">- Greet user with Welcome to ShopMe For the first time only
</span></span></span><span style="display:flex;"><span><span style="color:#d14">- always speak in Hindi
</span></span></span><span style="display:flex;"><span><span style="color:#d14">- Ensure all customer data is handled according to relevant privacy and data protection laws and ShopMe&#39;s privacy policy.
</span></span></span><span style="display:flex;"><span><span style="color:#d14">- In cases of high sensitivity or complexity, escalate the issue to a human customer support agent.
</span></span></span><span style="display:flex;"><span><span style="color:#d14">- Keep responses within a reasonable length to ensure they are easy to read and understand.&#34;&#34;&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="事件处理程序">事件处理程序</h5>
<p>管理聊天启动、消息接收、音频流媒体和会话终止事件。</p>
<p>首先，我们将初始化之前讨论的实时客户端。</p>
<p>参考: <a href="https://github.com/monuminu/AOAI_Samples/blob/main/realtime-assistant-support/app.py">app.py</a></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">async</span> <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">setup_openai_realtime</span>(system_prompt: <span style="color:#0086b3">str</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;&#34;&#34;Instantiate and configure the OpenAI Realtime Client&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    openai_realtime <span style="color:#000;font-weight:bold">=</span> RealtimeClient(system_prompt <span style="color:#000;font-weight:bold">=</span> system_prompt)
</span></span><span style="display:flex;"><span>    cl<span style="color:#000;font-weight:bold">.</span>user_session<span style="color:#000;font-weight:bold">.</span>set(<span style="color:#d14">&#34;track_id&#34;</span>, <span style="color:#0086b3">str</span>(uuid4()))
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">async</span> <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">handle_conversation_updated</span>(event):
</span></span><span style="display:flex;"><span>        item <span style="color:#000;font-weight:bold">=</span> event<span style="color:#000;font-weight:bold">.</span>get(<span style="color:#d14">&#34;item&#34;</span>)
</span></span><span style="display:flex;"><span>        delta <span style="color:#000;font-weight:bold">=</span> event<span style="color:#000;font-weight:bold">.</span>get(<span style="color:#d14">&#34;delta&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#d14">&#34;&#34;&#34;Currently used to stream audio back to the client.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> delta:
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic"># Only one of the following will be populated for any given event</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">if</span> <span style="color:#d14">&#39;audio&#39;</span> <span style="color:#000;font-weight:bold">in</span> delta:
</span></span><span style="display:flex;"><span>                audio <span style="color:#000;font-weight:bold">=</span> delta[<span style="color:#d14">&#39;audio&#39;</span>]  <span style="color:#998;font-style:italic"># Int16Array, audio added</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">await</span> cl<span style="color:#000;font-weight:bold">.</span>context<span style="color:#000;font-weight:bold">.</span>emitter<span style="color:#000;font-weight:bold">.</span>send_audio_chunk(cl<span style="color:#000;font-weight:bold">.</span>OutputAudioChunk(mimeType<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;pcm16&#34;</span>, data<span style="color:#000;font-weight:bold">=</span>audio, track<span style="color:#000;font-weight:bold">=</span>cl<span style="color:#000;font-weight:bold">.</span>user_session<span style="color:#000;font-weight:bold">.</span>get(<span style="color:#d14">&#34;track_id&#34;</span>)))
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">if</span> <span style="color:#d14">&#39;transcript&#39;</span> <span style="color:#000;font-weight:bold">in</span> delta:
</span></span><span style="display:flex;"><span>                transcript <span style="color:#000;font-weight:bold">=</span> delta[<span style="color:#d14">&#39;transcript&#39;</span>]  <span style="color:#998;font-style:italic"># string, transcript added</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">pass</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">if</span> <span style="color:#d14">&#39;arguments&#39;</span> <span style="color:#000;font-weight:bold">in</span> delta:
</span></span><span style="display:flex;"><span>                arguments <span style="color:#000;font-weight:bold">=</span> delta[<span style="color:#d14">&#39;arguments&#39;</span>]  <span style="color:#998;font-style:italic"># string, function arguments added</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">pass</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">async</span> <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">handle_item_completed</span>(item):
</span></span><span style="display:flex;"><span>        <span style="color:#d14">&#34;&#34;&#34;Used to populate the chat context with transcription once an item is completed.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># print(item) # TODO</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">pass</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">async</span> <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">handle_conversation_interrupt</span>(event):
</span></span><span style="display:flex;"><span>        <span style="color:#d14">&#34;&#34;&#34;Used to cancel the client previous audio playback.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        cl<span style="color:#000;font-weight:bold">.</span>user_session<span style="color:#000;font-weight:bold">.</span>set(<span style="color:#d14">&#34;track_id&#34;</span>, <span style="color:#0086b3">str</span>(uuid4()))
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">await</span> cl<span style="color:#000;font-weight:bold">.</span>context<span style="color:#000;font-weight:bold">.</span>emitter<span style="color:#000;font-weight:bold">.</span>send_audio_interrupt()
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">async</span> <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">handle_error</span>(event):
</span></span><span style="display:flex;"><span>        logger<span style="color:#000;font-weight:bold">.</span>error(event)
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="会话管理">会话管理</h5>
<p>维护用户会话，处理对话中断，确保交互流程顺畅。正如下面的代码所示，每当收到一个音频片段时，都应使用实时客户端将音频片段发送过去。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">if</span> openai_realtime:            
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span> openai_realtime<span style="color:#000;font-weight:bold">.</span>is_connected():
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">await</span> openai_realtime<span style="color:#000;font-weight:bold">.</span>append_input_audio(chunk<span style="color:#000;font-weight:bold">.</span>data)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>        logger<span style="color:#000;font-weight:bold">.</span>info(<span style="color:#d14">&#34;RealtimeClient is not connected&#34;</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="测试与部署">测试与部署</h3>
<p>一旦语音机器人构建完成，彻底的测试至关重要，以确保其可靠性和用户满意度。</p>
<ol>
<li>
<p>本地测试:</p>
<ul>
<li>使用AI Studio实时音频工作台与已部署的模型进行交互。</li>
<li>测试各种功能，包括语音识别、响应生成和工具执行。</li>
</ul>
</li>
<li>
<p>集成测试：</p>
<ul>
<li>确保应用程序能够无缝地与实时 API 进行通信。</li>
<li>测试事件处理程序和工具集成，以验证在不同场景下是否存在正确的行为。</li>
</ul>
</li>
<li>
<p>部署:</p>
<ul>
<li>将应用程序部署到生产环境中，利用云服务实现可扩展性。</li>
<li>监控性能，并根据需要进行调整以应对实际应用。</li>
</ul>
</li>
</ol>
<h3 id="最后">最后</h3>
<p>多亏了 GPT-4o 实时API，构建实时语音机器人从未像现在这样容易。通过将语音到语音功能整合到一个高效的界面中，开发者可以创建引人入胜且自然的对话体验，无需处理管理多个模型的复杂性。无论是提升客户支持、开发教育工具还是创建交互式应用程序，GPT-4o 实时API都提供了坚实的基础，让语音机器人成为现实。</p>
<h3 id="参考">参考</h3>
<ul>
<li>Azure OpenAI GPT-4o 实时 API 文档</li>
</ul>
<p><a href="https://learn.microsoft.com/en-us/azure/ai-services/openai/realtime-audio-quickstart?pivots=programming-language-ai-studio?WT.mc_id=AI-MVP-5003172">https://learn.microsoft.com/en-us/azure/ai-services/openai/realtime-audio-quickstart?pivots=programming-language-ai-studio</a></p>
<ul>
<li>Azure OpenAI GPT-4o 实时 API GitHub 仓库</li>
</ul>
<p><a href="https://github.com/monuminu/AOAI_Samples/tree/main/realtime-assistant-support">https://github.com/monuminu/AOAI_Samples/tree/main/realtime-assistant-support</a></p>

        </div>

        
<div class="post-archive">
    <ul class="post-copyright">
        <li><strong>原文作者：</strong><a rel="author" href="https://beanhsiang.github.io/">BeanHsiang</a></li>
        <li style="word-break:break-all"><strong>原文链接：</strong><a href="https://beanhsiang.github.io/post/2024-10-15-building-your-first-voice-bot-with-gpt-4o-real-time-api/">https://beanhsiang.github.io/post/2024-10-15-building-your-first-voice-bot-with-gpt-4o-real-time-api/</a></li>
        <li><strong>版权声明：</strong>本作品采用<a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a>. 进行许可，非商业转载请注明出处（作者，原文链接），商业转载请联系作者获得授权。</li>
    </ul>
</div>
<br/>



        

<div class="post-archive">
    <h2>相关文章</h2>
    <ul class="listing">
        
        <li><a href="/post/2024-09-08-retrieval-augmented-fine-tuning-use-gpt-4o-to-fine-tune-gpt-4o/">检索增强微调：使用 GPT-4o 微调 GPT-4o mini 模型以适用于特定领域应用</a></li>
        
        <li><a href="/post/2024-08-09-reduce-latency-for-azure-speech/">语音识别与合成中的延迟问题及解决策略</a></li>
        
        <li><a href="/post/2024-06-21-llm-is-the-brain-and-rpa-are-the-hands/">LLM 是脑，RPA 是手</a></li>
        
        <li><a href="/post/2024-06-07-finetune-small-language-model-phi-3-using-azure-machine/">使用 Azure 机器学习对小型语言模型 Phi-3 进行微调</a></li>
        
        <li><a href="/post/2024-05-15-azure-openai-speech/">Azure OpenAI 语音聊天</a></li>
        
    </ul>
</div>


        <div class="post-meta meta-tags">
            
            <ul class="clearfix">
                
                <li><a href='/tags/Real-Time-API' target="_blank">Real-Time API</a></li>
                
                <li><a href='/tags/GPT-4o' target="_blank">GPT-4o</a></li>
                
            </ul>
            
        </div>
    </article>
    
    

    
    
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "BeanHsiang/Greedy"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
    
    
    

</div>

                    <footer id="footer">
    <div>
        &copy; 2024 <a href="https://beanhsiang.github.io/">Innovation with tech By BeanHsiang</a>
        
    </div>
    <br />
    <div>
        <div class="github-badge">
            <a href="https://gohugo.io/" target="_black" rel="nofollow"><span class="badge-subject">Powered by</span><span class="badge-value bg-blue">Hugo</span></a>
        </div>
        <div class="github-badge">
            <a href="https://github.com/flysnow-org/maupassant-hugo" target="_black"><span class="badge-subject">Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a>
        </div>
    </div>
</footer>


    
    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script><script src="//cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>

<style type="text/css">
div.highlight {
    position: relative;
    margin: 1em 0px;
}

.copy-code {
    display: none;
    position: absolute;
    top: 4px;
    right: 4px;
    color: rgba(255, 255, 255, 0.8);
    background: rgba(78, 78, 78, 0.8);
    border-radius: var(--radius);
    padding: 0 5px;
    font: inherit;
    user-select: none;
    cursor: pointer;
    border: 0;
    --radius: 8px;
}

div.highlight:hover .copy-code,pre:hover .copy-code {
    display: block;
}

</style>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>


    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='https://beanhsiang.github.io/search' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://beanhsiang.github.io/">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>

    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://beanhsiang.github.io/post/2024-10-15-building-your-first-voice-bot-with-gpt-4o-real-time-api/" title="使用 GPT-4o 实时 API 构建一个语音机器人" target="_blank">使用 GPT-4o 实时 API 构建一个语音机器人</a>
    </li>
    
    <li>
        <a href="https://beanhsiang.github.io/post/2024-09-08-retrieval-augmented-fine-tuning-use-gpt-4o-to-fine-tune-gpt-4o/" title="检索增强微调：使用 GPT-4o 微调 GPT-4o mini 模型以适用于特定领域应用" target="_blank">检索增强微调：使用 GPT-4o 微调 GPT-4o mini 模型以适用于特定领域应用</a>
    </li>
    
    <li>
        <a href="https://beanhsiang.github.io/post/2024-08-09-reduce-latency-for-azure-speech/" title="语音识别与合成中的延迟问题及解决策略" target="_blank">语音识别与合成中的延迟问题及解决策略</a>
    </li>
    
    <li>
        <a href="https://beanhsiang.github.io/post/2024-06-21-llm-is-the-brain-and-rpa-are-the-hands/" title="LLM 是脑，RPA 是手" target="_blank">LLM 是脑，RPA 是手</a>
    </li>
    
    <li>
        <a href="https://beanhsiang.github.io/post/2024-06-07-finetune-small-language-model-phi-3-using-azure-machine/" title="使用 Azure 机器学习对小型语言模型 Phi-3 进行微调" target="_blank">使用 Azure 机器学习对小型语言模型 Phi-3 进行微调</a>
    </li>
    
    <li>
        <a href="https://beanhsiang.github.io/post/2024-05-15-azure-openai-speech/" title="Azure OpenAI 语音聊天" target="_blank">Azure OpenAI 语音聊天</a>
    </li>
    
    <li>
        <a href="https://beanhsiang.github.io/post/2024-04-25-why-is-it-difficult-to-land-large-models/" title="为什么大模型难落地？" target="_blank">为什么大模型难落地？</a>
    </li>
    
    <li>
        <a href="https://beanhsiang.github.io/post/2024-04-17-keyless-authentication-with-azure-openai/" title="实现 Azure OpenAI 无密钥身份验证" target="_blank">实现 Azure OpenAI 无密钥身份验证</a>
    </li>
    
    <li>
        <a href="https://beanhsiang.github.io/post/2024-03-17-building-your-custom-copilot-with-semantic-kernel/" title="使用 Semantic Kernel 构建自定义 Copilot" target="_blank">使用 Semantic Kernel 构建自定义 Copilot</a>
    </li>
    
    <li>
        <a href="https://beanhsiang.github.io/post/2024-03-07-lets-start-with-the-bootloader/" title="从引导程序说起" target="_blank">从引导程序说起</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title"><a href='/categories/'>分类</a></h3>
<ul class="widget-list">
    
    <li><a href="https://beanhsiang.github.io/categories/Azure-AI/">Azure AI (21)</a></li>
    
    <li><a href="https://beanhsiang.github.io/categories/FireUG/">FireUG (2)</a></li>
    
    <li><a href="https://beanhsiang.github.io/categories/GitHub-Copilot/">GitHub Copilot (2)</a></li>
    
    <li><a href="https://beanhsiang.github.io/categories/ML.NET/">ML.NET (8)</a></li>
    
    <li><a href="https://beanhsiang.github.io/categories/%E7%A9%BF%E8%B6%8A%E4%BA%BA%E6%9C%BA%E8%9E%8D%E5%90%88%E4%B9%8B%E9%99%85/">穿越人机融合之际 (3)</a></li>
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title"><a href='/tags/'>标签</a></h3>
<div class="tagcloud">
    
    <a href="https://beanhsiang.github.io/tags/Azure-AI/">Azure AI</a>
    
    <a href="https://beanhsiang.github.io/tags/Azure-Machine-Learning/">Azure Machine Learning</a>
    
    <a href="https://beanhsiang.github.io/tags/Azure-OpenAI/">Azure OpenAI</a>
    
    <a href="https://beanhsiang.github.io/tags/Azure-Speech/">Azure Speech</a>
    
    <a href="https://beanhsiang.github.io/tags/FireUG/">FireUG</a>
    
    <a href="https://beanhsiang.github.io/tags/GitHub-Copilot/">GitHub Copilot</a>
    
    <a href="https://beanhsiang.github.io/tags/GPT-4o/">GPT-4o</a>
    
    <a href="https://beanhsiang.github.io/tags/Microsoft-Entra-ID/">Microsoft Entra ID</a>
    
    <a href="https://beanhsiang.github.io/tags/ML.NET/">ML.NET</a>
    
    <a href="https://beanhsiang.github.io/tags/Phi-3/">Phi-3</a>
    
    <a href="https://beanhsiang.github.io/tags/RAFT/">RAFT</a>
    
    <a href="https://beanhsiang.github.io/tags/Real-Time-API/">Real-Time API</a>
    
    <a href="https://beanhsiang.github.io/tags/%E7%A9%BF%E8%B6%8A%E4%BA%BA%E6%9C%BA%E8%9E%8D%E5%90%88%E4%B9%8B%E9%99%85/">穿越人机融合之际</a>
    
</div>
    </section>

    
<section class="widget">
    <h3 class="widget-title">友情链接</h3>
    <ul class="widget-list">
        
        <li>
            <a target="_blank" href="https://fireusergroup.com/" title="FireUG">FireUG 技术社区</a>
        </li>
        
        <li>
            <a target="_blank" href="https://space.bilibili.com/545713776" title="FireUG 技术社区 - B 站">FireUG 技术社区 - B 站</a>
        </li>
        
        <li>
            <a target="_blank" href="https://www.douyin.com/user/MS4wLjABAAAAYGG_Q3--hpBKc7rq2h-slFNFObDCmrxYc8OF2tl_mV4" title="火油鸡">火油鸡</a>
        </li>
        
    </ul>
</section>


    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="https://beanhsiang.github.io/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
</body>

</html>