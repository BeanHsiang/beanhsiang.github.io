<!doctype html>
<html lang="zh-Hans">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="referrer" content="no-referrer-when-downgrade">
    

    <title>ä¸º Azure Voice Live æ„å»ºå¯ç”¨äºç”Ÿäº§çš„ SIP ç½‘å…³ | Innovation with tech</title>
    <meta property="og:title" content="ä¸º Azure Voice Live æ„å»ºå¯ç”¨äºç”Ÿäº§çš„ SIP ç½‘å…³ - Innovation with tech">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2026-01-04T12:00:00&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2026-01-04T12:00:00&#43;08:00'>
        
    <meta name="Keywords" content="C#,.Net,Python,Nodejs,Java,Golang,åšå®¢,è½¯ä»¶æ¶æ„,äº‘åŸç”Ÿ,æœºå™¨å­¦ä¹ ,æ•°æ®åˆ†æ,RPA,è‡ªåŠ¨åŒ–,æŠ€æœ¯ç®¡ç†">
    <meta name="description" content="ä¸º Azure Voice Live æ„å»ºå¯ç”¨äºç”Ÿäº§çš„ SIP ç½‘å…³">
    <meta name="author" content="">
    <meta property="og:url" content="https://beanhsiang.github.io/post/2026-01-04-building-a-production-ready-sip-gateway-for-azure-voice-live/">
    <link rel="shortcut icon" href='/favicon.ico'  type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    
    
        <link href="https://cdn.bootcdn.net/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" rel="stylesheet">
    
    
    
    
</head>

<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://beanhsiang.github.io/">
                        Innovation with tech
                    </a>
                
                <p class="description">ä¸€ä¸ªæŠ€æœ¯è€å…µå·¥ä½œçš„ç‚¹æ»´è®°å½•ï¼Œä¸“æ³¨ã€æ²Ÿé€šã€ä¹åœ¨åˆ†äº«!</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="current" href="https://beanhsiang.github.io/">é¦–é¡µ</a>
                    
                    <a  href="https://beanhsiang.github.io/tools/" title="å·¥å…·">å·¥å…·</a>
                    
                    <a  href="https://beanhsiang.github.io/archives/" title="å½’æ¡£">å½’æ¡£</a>
                    
                    <a  href="https://beanhsiang.github.io/about/" title="å…³äº">å…³äº</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    
    <article class="post">
        <header>
            <h1 class="post-title">ä¸º Azure Voice Live æ„å»ºå¯ç”¨äºç”Ÿäº§çš„ SIP ç½‘å…³</h1>
        </header>
        
  <time datetime="2026-01-04T04:00:00Z" class="post-meta meta-date dt-published">
    2026å¹´1æœˆ4æ—¥
  </time>


<div class="post-meta meta-category">
  <span>&nbsp;|</span>
  
    <a href='/categories/Microsoft-Foundry' target="_blank">Microsoft Foundry</a>
  
</div>


        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">&nbsp;|
                <span id="busuanzi_value_page_pv"></span> <span>é˜…è¯»</span>
            </span>
        </div>
        
        
        <div class="post-content">
            <p>åŸæ–‡é“¾æ¥ï¼š<a href="https://techcommunity.microsoft.com/blog/azure-ai-foundry-blog/from-zero-to-hero-building-a-production-ready-sip-gateway-for-azure-voice-live/4473405?WT.mc_id=AI-MVP-5003172">https://techcommunity.microsoft.com/blog/azure-ai-foundry-blog/from-zero-to-hero-building-a-production-ready-sip-gateway-for-azure-voice-live/4473405?WT.mc_id=AI-MVP-5003172</a></p>
<p>
        <a data-fancybox="gallery" href="/uploads/20260105102739-236de1e20b0f4b64a8b41a799b4589a0.png">
            <img class="mx-auto" alt="" src="/uploads/20260105102739-236de1e20b0f4b64a8b41a799b4589a0.png" />
        </a>
    </p>
<p><em>é¢˜å›¾æ¥æºï¼šMicrosoft Tech Community / Microsoft Foundry Blog</em></p>
<h2 id="å¼•è¨€">å¼•è¨€</h2>
<p>è¯­éŸ³æŠ€æœ¯æ­£åœ¨é‡å¡‘äººå’Œæœºå™¨çš„äº¤äº’æ–¹å¼ï¼Œè®©ä¸ AI çš„å¯¹è¯æ¯”ä»¥å¾€æ›´è‡ªç„¶ã€‚éšç€ Voice Live API çš„ public beta å‘å¸ƒï¼Œå¼€å‘è€…æ‹¥æœ‰äº†æ„å»ºä½å»¶è¿Ÿã€å¤šæ¨¡æ€è¯­éŸ³ä½“éªŒçš„å·¥å…·ï¼Œåœ¨åº”ç”¨ä¸­å¯ä»¥åšå‡ºå¾ˆå¤šæ–°ç©æ³•ã€‚</p>
<p>è¿‡å»ï¼Œæƒ³åšä¸€ä¸ªè¯­éŸ³æœºå™¨äººï¼Œå¾€å¾€éœ€è¦æŠŠå¤šä¸ªæ¨¡å‹â€œä¸²èµ·æ¥â€ï¼šæ¯”å¦‚ç”¨ ASRï¼ˆè‡ªåŠ¨è¯­éŸ³è¯†åˆ«ï¼‰æ¨¡å‹ï¼ˆåƒ Whisperï¼‰åšè½¬å†™ã€å†ç”¨æ–‡æœ¬æ¨¡å‹åšæ¨ç†ã€æœ€åç”¨ TTSï¼ˆæ–‡æœ¬è½¬è¯­éŸ³ï¼‰æ¨¡å‹ç”Ÿæˆè¯­éŸ³è¾“å‡ºã€‚è¿™æ¡é“¾è·¯é€šå¸¸ä¼šå¸¦æ¥æ˜æ˜¾å»¶è¿Ÿï¼Œå¹¶ä¸”åœ¨æƒ…æ„Ÿè¡¨è¾¾ç­‰ç»†èŠ‚ä¸Šä¼šæœ‰æŸå¤±ã€‚</p>
<p>Voice Live API çš„å…³é”®å˜åŒ–åœ¨äºï¼šå®ƒæŠŠè¿™äº›èƒ½åŠ›æ•´åˆåˆ°ä¸€æ¬¡ API è°ƒç”¨é‡Œã€‚å¼€å‘è€…é€šè¿‡å»ºç«‹æŒä¹…çš„ WebSocket è¿æ¥ï¼Œå°±èƒ½ç›´æ¥æµå¼ä¼ è¾“è¾“å…¥/è¾“å‡ºéŸ³é¢‘ï¼Œæ˜¾è‘—é™ä½å»¶è¿Ÿå¹¶æå‡å¯¹è¯çš„è‡ªç„¶åº¦ã€‚åŒæ—¶ï¼ŒAPI è¿˜æ”¯æŒ function callingï¼Œè®©è¯­éŸ³æœºå™¨äººå¯ä»¥åœ¨å¯¹è¯è¿‡ç¨‹ä¸­å³æ—¶æ‰§è¡ŒåŠ¨ä½œï¼ˆä¾‹å¦‚ä¸‹å•ã€æŸ¥è¯¢å®¢æˆ·ä¿¡æ¯ç­‰ï¼‰ã€‚</p>
<p>è¿™ç¯‡æ–‡ç« ä»ç¬¬ä¸‰æ–¹æŠ€æœ¯åšä¸»è§†è§’ï¼Œæ¢³ç† Microsoft å›¢é˜Ÿç»™å‡ºçš„ä¸€ä¸ªå®Œæ•´æ–¹æ¡ˆï¼šä¸€ä¸ªåŸºäº Python çš„ SIP ç½‘å…³ï¼Œç”¨æ¥æŠŠä¼ ç»Ÿç”µè¯/è¯­éŸ³ç³»ç»Ÿï¼ˆSIP/RTPï¼‰ä¸ Azure çš„ Voice Live å®æ—¶å¯¹è¯ APIï¼ˆWebSocketï¼‰è¿æ¥èµ·æ¥ã€‚å€ŸåŠ©è¿™ä¸ªç½‘å…³ï¼Œä»»ä½• SIP ç«¯ç‚¹ï¼ˆåº§æœºã€è½¯ç”µè¯ã€ç”šè‡³ç»ç”± PSTN è½¬å…¥çš„æ¥ç”µï¼‰éƒ½å¯ä»¥ä¸ AI è¿›è¡Œè‡ªç„¶çš„è¯­éŸ³å¯¹è¯ã€‚</p>
<p>è¯»å®Œæœ¬æ–‡ï¼Œä½ å°†ç†è§£ï¼š</p>
<ul>
<li>ç”Ÿäº§çº§ SIP-to-WebSocket ç½‘å…³çš„æ•´ä½“æ¶æ„è®¾è®¡</li>
<li>éŸ³é¢‘è½¬ç ä¸é‡é‡‡æ ·ç­–ç•¥ï¼ˆä¿è¯åª’ä½“æ ¼å¼æ— ç¼è½¬æ¢ï¼‰</li>
<li>çœŸå®éƒ¨ç½²æ‹“æ‰‘ï¼šäº‘ä¸Šç”µè¯ç³»ç»Ÿä¸æœ¬åœ°ä¼ä¸šç³»ç»Ÿï¼ˆå¦‚ Avayaã€Genesysï¼‰å¯¹æ¥</li>
<li>æœ¬åœ°æµ‹è¯•ä¸ä¼ä¸šç”Ÿäº§ç¯å¢ƒçš„é€æ­¥é…ç½®æŒ‡å—</li>
</ul>
<h2 id="æ¶æ„æ¦‚è§ˆ">æ¶æ„æ¦‚è§ˆ</h2>
<h3 id="é«˜å±‚è®¾è®¡">é«˜å±‚è®¾è®¡</h3>
<p><strong>Voice Live API çš„å·¥ä½œæ–¹å¼</strong></p>
<p>ä¼ ç»Ÿè¯­éŸ³åŠ©æ‰‹å¾€å¾€éœ€è¦é“¾è·¯å¼ç»„åˆï¼šASRï¼ˆè½¬å†™ï¼‰+ æ–‡æœ¬æ¨¡å‹ï¼ˆæ¨ç†ï¼‰+ TTSï¼ˆåˆæˆï¼‰ã€‚å¤šæ­¥éª¤ä¸ä»…å¢åŠ å»¶è¿Ÿï¼Œä¹Ÿæ›´å®¹æ˜“ä¸¢å¤±å¯¹è¯çš„â€œæƒ…ç»ª/è¯­æ°”â€ç»†èŠ‚ã€‚</p>
<p>Voice Live API é€šè¿‡ä¸€ä¸ªæŒç»­çš„ WebSocket è¿æ¥æŠŠè¿™äº›èƒ½åŠ›åˆåœ¨ä¸€èµ·ï¼šå¯ä»¥å®æ—¶æµå¼è¾“å…¥éŸ³é¢‘å¹¶å¾—åˆ°éŸ³é¢‘è¾“å‡ºï¼Œä»è€Œæ˜¾è‘—é™ä½ç«¯åˆ°ç«¯å»¶è¿Ÿï¼Œå¹¶å¢å¼ºå¯¹è¯çš„è‡ªç„¶æ„Ÿã€‚æ­¤å¤–ï¼Œfunction calling è®©è¯­éŸ³æœºå™¨äººå¯ä»¥åœ¨å¯¹è¯ä¸­ä¸»åŠ¨è§¦å‘ä¸šåŠ¡åŠ¨ä½œã€‚</p>
<p>æœ¬æ–‡çš„ç½‘å…³åœ¨ SIP/RTPï¼ˆç”µè¯è¯­éŸ³ä¸–ç•Œï¼‰ä¸ Azure Voice Live çš„ WebSocket å®æ—¶ API ä¹‹é—´å……å½“ <strong>åŒå‘åª’ä½“ä»£ç†ï¼ˆbidirectional media proxyï¼‰</strong>ï¼šæ—¢ç¿»è¯‘ä¿¡ä»¤åè®®ï¼Œä¹Ÿè½¬æ¢éŸ³é¢‘æ ¼å¼ï¼Œä»è€Œè®©ä¼ ç»Ÿ VoIP åŸºç¡€è®¾æ–½ä¸ç°ä»£ AI å¯¹è¯ä»£ç†å®ç°â€œæ— æ„Ÿé›†æˆâ€ã€‚</p>
<h3 id="å…³é”®è®¾è®¡åŸåˆ™">å…³é”®è®¾è®¡åŸåˆ™</h3>
<ol>
<li><strong>å¼‚æ­¥ä¼˜å…ˆï¼ˆAsynchronous-Firstï¼‰</strong>ï¼šåŸºäº asyncio æ„å»ºéé˜»å¡ I/Oï¼Œè¿½æ±‚ä½å»¶è¿Ÿä¸é«˜å¹¶å‘æ½œåŠ›</li>
<li><strong>å…³æ³¨ç‚¹åˆ†ç¦»ï¼ˆSeparation of Concernsï¼‰</strong>ï¼šSIPã€åª’ä½“ã€Voice Live é›†æˆåˆ†å±‚æ¨¡å—åŒ–</li>
<li><strong>ç”Ÿäº§çº§é”™è¯¯å¤„ç†</strong>ï¼šéŸ³é¢‘é˜Ÿåˆ—ä¸‹æº¢æ—¶ï¼Œä¼˜é›…é™çº§ï¼ˆæ³¨å…¥é™éŸ³å¸§ï¼‰è€Œä¸æ˜¯æŠ–åŠ¨/æ‰è¯</li>
<li><strong>ç»“æ„åŒ–æ—¥å¿—</strong>ï¼šä½¿ç”¨ structlog è¾“å‡ºå¯æœºå™¨è§£æã€å¸¦ä¸Šä¸‹æ–‡çš„æ—¥å¿—ï¼Œä¾¿äºå¯è§‚æµ‹æ€§</li>
<li><strong>ç±»å‹å®‰å…¨</strong>ï¼špydantic æ ¡éªŒé…ç½® + mypy é™æ€æ£€æŸ¥</li>
</ol>
<h2 id="æ ¸å¿ƒç»„ä»¶">æ ¸å¿ƒç»„ä»¶</h2>
<p>
        <a data-fancybox="gallery" href="/uploads/20260105102742-852d19aa680e4a6b8785dcd18d003809.png">
            <img class="mx-auto" alt="" src="/uploads/20260105102742-852d19aa680e4a6b8785dcd18d003809.png" />
        </a>
    </p>
<p>SBCï¼ˆä¼šè¯è¾¹ç•Œæ§åˆ¶å™¨ï¼‰çš„å…³é”®ä½œç”¨ï¼š</p>
<ul>
<li>ç»ˆæ­¢è¿è¥å•†ä¾§ SIPï¼Œå¹¶å‘ Azure SIP/RTC ç«¯ç‚¹è¿›è¡Œäº’é€š</li>
<li>è§„èŒƒåŒ– SIP Headerã€ç§»é™¤ä¸æ”¯æŒçš„é€‰é¡¹ã€å¹¶åšç¼–è§£ç æ˜ å°„</li>
<li>æä¾›å®‰å…¨èƒ½åŠ›ï¼šTLS ä¿¡ä»¤ã€SRTP åª’ä½“ã€æ‹“æ‰‘éšè—ã€ACL</li>
<li>å¯é€‰åšåª’ä½“é”šå®šï¼ˆmedia anchoringï¼‰ï¼šç”¨äºåˆè§„å½•éŸ³ã€QoS å¹³æ»‘ã€åˆæ³•ç›‘å¬ç­‰</li>
</ul>
<h3 id="é¡¹ç›®ç»“æ„">é¡¹ç›®ç»“æ„</h3>
<pre tabindex="0"><code>src/voicelive_sip_gateway/
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ settings.py          # Pydantic-based configuration
â”œâ”€â”€ gateway/
â”‚   â””â”€â”€ main.py              # Application entry point &amp; lifecycle
â”œâ”€â”€ logging/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ setup.py             # Structlog configuration
â”œâ”€â”€ media/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ stream_bridge.py     # Bidirectional audio queue manager
â”‚   â””â”€â”€ transcode.py         # Î¼-law â†” PCM16 + resampling
â”œâ”€â”€ sip/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ agent.py             # pjsua2 wrapper &amp; call handling
â”‚   â”œâ”€â”€ rtp.py               # RTP utilities
â”‚   â””â”€â”€ sdp.py               # SDP parsing/generation
â””â”€â”€ voicelive/
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ client.py            # Azure Voice Live SDK wrapper
    â””â”€â”€ events.py            # Event type mapping
</code></pre><h3 id="å‘¼å«æµç¨‹call-flow">å‘¼å«æµç¨‹ï¼ˆCall Flowï¼‰</h3>
<ol>
<li>å®¢æˆ·æ‹¨æ‰“ä½ çš„å·ç </li>
<li>Audiocodes SBC ä» PSTN æ”¶åˆ°å‘¼å«ï¼Œå¹¶å‘ Asterisk è½¬å‘ SIP INVITE</li>
<li>Asterisk çš„è·¯ç”±é€»è¾‘æŠŠ INVITE è½¬åˆ° <code>voicelive-bot@gateway.example.com</code></li>
<li>Voice Live Gateway ä»¥ SIP ç»ˆç«¯æ–¹å¼å‘ Asterisk æ³¨å†Œå¹¶æ¥å¬</li>
<li>RTP éŸ³é¢‘æµï¼šCaller â†” SBC â†” Asterisk â†” Gateway â†” Azure</li>
</ol>
<h2 id="éŸ³é¢‘æµæ°´çº¿ä»-Î¼-law-åˆ°-pcm16">éŸ³é¢‘æµæ°´çº¿ï¼šä» Î¼-law åˆ° PCM16</h2>
<h3 id="æŒ‘æˆ˜">æŒ‘æˆ˜</h3>
<p>ä¼ ç»Ÿç”µè¯è¯­éŸ³å¸¸ç”¨ <strong>G.711 Î¼-law</strong> ç¼–ç ï¼Œé‡‡æ ·ç‡ <strong>8 kHz</strong>ï¼ˆå¸¦å®½æ•ˆç‡é«˜ï¼‰ã€‚è€Œ Azure Voice Live æœŸæœ›çš„æ˜¯ <strong>PCM16ï¼ˆ16-bit çº¿æ€§ PCMï¼‰</strong>ï¼Œé‡‡æ ·ç‡ <strong>24 kHz</strong>ã€‚å› æ­¤ç½‘å…³éœ€è¦åœ¨å®æ—¶é“¾è·¯ä¸­å®Œæˆï¼š</p>
<ul>
<li>ç¼–è§£ç è½¬æ¢ï¼ˆÎ¼-law â†” PCM16ï¼‰</li>
<li>é‡‡æ ·ç‡è½¬æ¢ï¼ˆ8 kHz â†” 24 kHzï¼‰</li>
</ul>
<p>å¹¶ä¸”è¦å°½å¯èƒ½ä½å»¶è¿Ÿã€‚</p>
<h3 id="éŸ³é¢‘æµç¤ºæ„">éŸ³é¢‘æµç¤ºæ„</h3>
<pre tabindex="0"><code>Caller (SIP)                    Gateway                     Azure Voice Live
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                   â”€â”€â”€â”€â”€â”€â”€                     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚                              â”‚                               â”‚
    â”‚ RTP: Î¼-law 8kHz              â”‚                               â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º                               â”‚
    â”‚                              â”‚                               â”‚
    â”‚                         â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”                          â”‚
    â”‚                         â”‚ pjsua2  â”‚ (decodes to PCM16 8kHz)  â”‚
    â”‚                         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                          â”‚
    â”‚                              â”‚                               â”‚
    â”‚                         â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
    â”‚                         â”‚ Resample    â”‚ (8kHz â†’ 24kHz)       â”‚
    â”‚                         â”‚ PCM16       â”‚                      â”‚
    â”‚                         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
    â”‚                              â”‚                               â”‚
    â”‚                              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
    â”‚                              â”‚   WebSocket: PCM16 24kHz      â”‚
    â”‚                              â”‚                               â”‚
    â”‚                              â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                              â”‚   Response: PCM16 24kHz       â”‚
    â”‚                              â”‚                               â”‚
    â”‚                         â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
    â”‚                         â”‚ Resample    â”‚ (24kHz â†’ 8kHz)       â”‚
    â”‚                         â”‚ PCM16       â”‚                      â”‚
    â”‚                         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
    â”‚                              â”‚                               â”‚
    â”‚                         â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”                          â”‚
    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ pjsua2  â”‚ (encodes to Î¼-law)       â”‚
    â”‚  RTP: Î¼-law 8kHz        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
</code></pre><p>ä¸‹é¢æŒ‘å‡ ä¸ªå…³é”®ä»£ç ç‚¹ï¼Œå¸®åŠ©ç†è§£ç«¯åˆ°ç«¯çš„éŸ³é¢‘æµã€‚</p>
<h3 id="éŸ³é¢‘æµæ¡¥æ¥stream_bridgepy">éŸ³é¢‘æµæ¡¥æ¥ï¼šstream_bridge.py</h3>
<p><code>AudioStreamBridge</code> é€šè¿‡ asyncio é˜Ÿåˆ—æ¥ç¼–æ’åŒå‘éŸ³é¢‘æµï¼š</p>
<pre tabindex="0"><code>class AudioStreamBridge:
    &#34;&#34;&#34;Bidirectional audio pump between SIP (Î¼-law) and Voice Live (PCM16 24kHz).&#34;&#34;&#34;

    VOICELIVE_SAMPLE_RATE = 24000
    SIP_SAMPLE_RATE = 8000

    def __init__(self, settings: Settings):
        self._inbound_queue: asyncio.Queue[bytes] = asyncio.Queue()   # SIP â†’ Voice Live
        self._outbound_queue: asyncio.Queue[bytes] = asyncio.Queue()  # Voice Live â†’ SIP
</code></pre><p><strong>å…¥ç«™é“¾è·¯ï¼ˆCaller â†’ AIï¼‰</strong>ï¼š</p>
<pre tabindex="0"><code>async def _flush(self) -&gt; None:
    &#34;&#34;&#34;Process inbound audio: PCM16 8kHz from SIP â†’ PCM16 24kHz to Voice Live.&#34;&#34;&#34;
    while True:
        pcm16_8k = await self._inbound_queue.get()
        pcm16_24k = resample_pcm16(pcm16_8k, self.SIP_SAMPLE_RATE, self.VOICELIVE_SAMPLE_RATE)
        if self._voicelive_client:
            await self._voicelive_client.send_audio_chunk(pcm16_24k)
</code></pre><p><strong>å‡ºç«™é“¾è·¯ï¼ˆAI â†’ Callerï¼‰</strong>ï¼š</p>
<pre tabindex="0"><code>async def emit_audio_to_sip(self, pcm_chunk: bytes) -&gt; None:
    &#34;&#34;&#34;Resample Voice Live audio down to 8 kHz PCM frames for SIP playback.&#34;&#34;&#34;
    pcm_8k = resample_pcm16(pcm_chunk, self.VOICELIVE_SAMPLE_RATE, self.SIP_SAMPLE_RATE)

    # Split into 20ms frames (160 samples @ 8kHz = 320 bytes)
    frame_size_bytes = 320
    for offset in range(0, len(pcm_8k), frame_size_bytes):
        frame = pcm_8k[offset : offset + frame_size_bytes]
        if frame:
            await self._outbound_queue.put(frame)
</code></pre><p><strong>å¸§æ—¶åºï¼ˆFrame Timingï¼‰</strong>ï¼šVoIP å¸¸ç”¨ 20ms å¸§ï¼ˆptime=20ï¼‰ã€‚åœ¨ 8 kHz ä¸‹ï¼š8000 samples/sec Ã— 0.020 sec = 160 samples = 320 bytesï¼ˆPCM16ï¼‰ã€‚</p>
<h2 id="ä½¿ç”¨-pjsua2-å¤„ç†-sip-ä¿¡ä»¤">ä½¿ç”¨ pjsua2 å¤„ç† SIP ä¿¡ä»¤</h2>
<h3 id="ä¸ºä»€ä¹ˆé€‰-pjsua2">ä¸ºä»€ä¹ˆé€‰ pjsua2ï¼Ÿ</h3>
<p><code>pjproject</code> åŸºæœ¬ç®—æ˜¯ SIP/RTP çš„â€œå·¥ä¸šæ ‡å‡†â€ï¼Œå¾ˆå¤šå•†ä¸šäº§å“ï¼ˆåŒ…æ‹¬ Asteriskï¼‰éƒ½åœ¨ç”¨ã€‚<code>pjsua2</code> æä¾›çš„ API å…·å¤‡ï¼š</p>
<ul>
<li>å®Œæ•´ SIP åè®®æ ˆï¼ˆINVITEã€ACKã€BYEã€REGISTER ç­‰ï¼‰</li>
<li>RTP/RTCP åª’ä½“å¤„ç†</li>
<li>å†…ç½®å¤šç§ç¼–è§£ç ï¼ˆG.711ã€G.722ã€Opus ç­‰ï¼‰</li>
<li>NAT ç©¿é€ï¼ˆSTUN/TURN/ICEï¼‰</li>
<li>çº¿ç¨‹å®‰å…¨çš„ C++ API + Python bindings</li>
</ul>
<h3 id="è‡ªå®šä¹‰åª’ä½“ç«¯å£custom-media-ports">è‡ªå®šä¹‰åª’ä½“ç«¯å£ï¼ˆCustom Media Portsï¼‰</h3>
<p>ä¸ºäº†æŠŠ pjsua2 çš„åª’ä½“ç®¡çº¿ä¸ asyncio é˜Ÿåˆ—æ¡¥æ¥èµ·æ¥ï¼Œéœ€è¦å®ç°è‡ªå®šä¹‰çš„ <code>AudioMediaPort</code> å­ç±»ã€‚</p>
<h4 id="æ¥æ”¶æ¥ç”µéŸ³é¢‘caller--voice-live">æ¥æ”¶æ¥ç”µéŸ³é¢‘ï¼ˆCaller â†’ Voice Liveï¼‰</h4>
<pre tabindex="0"><code>def onFrameReceived(self, frame: pj.MediaFrame) -&gt; None:
    &#34;&#34;&#34;Called by pjsua when it receives audio from caller (to Voice Live).&#34;&#34;&#34;
    if self._direction == &#34;to_voicelive&#34; and self._loop:
        if frame.type == pj.PJMEDIA_FRAME_TYPE_AUDIO and frame.buf:
            try:
                asyncio.run_coroutine_threadsafe(
                    self._bridge.enqueue_sip_audio(bytes(frame.buf)),
                    self._loop
                )
            except Exception as e:
                self._logger.warning(&#34;media.enqueue_failed&#34;, error=str(e))
</code></pre><p><strong>çº¿ç¨‹æ¨¡å‹æ³¨æ„ç‚¹</strong>ï¼špjsua2 çš„äº‹ä»¶å¾ªç¯è¿è¡Œåœ¨ä¸“ç”¨çº¿ç¨‹é‡Œï¼Œç¤ºä¾‹ç”¨ <code>asyncio.run_coroutine_threadsafe()</code> æŠŠéŸ³é¢‘æ•°æ®å®‰å…¨åœ°æŠ•é€’å›ä¸» asyncio loopã€‚</p>
<h4 id="å‘æ¥ç”µæ–¹å‘é€éŸ³é¢‘voice-live--caller">å‘æ¥ç”µæ–¹å‘é€éŸ³é¢‘ï¼ˆVoice Live â†’ Callerï¼‰</h4>
<pre tabindex="0"><code>def onFrameRequested(self, frame: pj.MediaFrame) -&gt; None:
    &#34;&#34;&#34;Called by pjsua when it needs audio to send to caller (from Voice Live).&#34;&#34;&#34;
    if self._direction == &#34;from_voicelive&#34; and self._loop:
        try:
            future = asyncio.run_coroutine_threadsafe(
                self._bridge.dequeue_sip_audio_nonblocking(),
                self._loop
            )
            pcm_data = future.result(timeout=0.050)

            # Ensure exactly 320 bytes (160 samples @ 8kHz)
            if len(pcm_data) != 320:
                pcm_data = (pcm_data + b&#39;\x00&#39; * 320)[:320]

            frame.type = pj.PJMEDIA_FRAME_TYPE_AUDIO
            frame.buf = pj.ByteVector(pcm_data)
            frame.size = len(pcm_data)
        except Exception:
            # Return silence on timeout/error
            frame.type = pj.PJMEDIA_FRAME_TYPE_AUDIO
            frame.buf = pj.ByteVector(b&#39;\x00&#39; * 320)
            frame.size = 320
</code></pre><p><strong>ä¼˜é›…é™çº§ï¼ˆGraceful Degradationï¼‰</strong>ï¼šå¦‚æœå‡ºç«™é˜Ÿåˆ—ä¸ºç©ºï¼ˆAI è¿˜æ²¡ç”ŸæˆéŸ³é¢‘ï¼‰ï¼Œå°±æ³¨å…¥é™éŸ³å¸§ï¼Œé¿å… RTP æŠ–åŠ¨/æ–­ç»­ã€‚</p>
<h3 id="å‘¼å«çŠ¶æ€ç®¡ç†call-state-management">å‘¼å«çŠ¶æ€ç®¡ç†ï¼ˆCall State Managementï¼‰</h3>
<pre tabindex="0"><code>class GatewayCall(pj.Call):
    &#34;&#34;&#34;Handles SIP call lifecycle and connects media bridge.&#34;&#34;&#34;

    def onCallState(self, prm: pj.OnCallStateParam) -&gt; None:
        ci = self.getInfo()
        self._logger.info(&#34;sip.call_state&#34;, remote_uri=ci.remoteUri, state=ci.stateText)

        if ci.state == pj.PJSIP_INV_STATE_DISCONNECTED:
            self._cleanup()
            self._account.current_call = None

    def onCallMediaState(self, prm: pj.OnCallMediaStateParam) -&gt; None:
        ci = self.getInfo()
        for mi in ci.media:
            if mi.type == pj.PJMEDIA_TYPE_AUDIO and mi.status == pj.PJSUA_CALL_MEDIA_ACTIVE:
                media = self.getMedia(mi.index)
                aud_media = pj.AudioMedia.typecastFromMedia(media)

                # Create bidirectional media bridge
                self._to_voicelive_port = CustomAudioMediaPort(self._bridge, &#34;to_voicelive&#34;, self._logger)
                self._from_voicelive_port = CustomAudioMediaPort(self._bridge, &#34;from_voicelive&#34;, self._logger)

                # Connect: Caller â†’ to_voicelive_port â†’ Voice Live
                aud_media.startTransmit(self._to_voicelive_port)
                # Connect: Voice Live â†’ from_voicelive_port â†’ Caller
                self._from_voicelive_port.startTransmit(aud_media)

                # Start AI conversation with greeting
                asyncio.run_coroutine_threadsafe(
                    self._voicelive_client.request_response(interrupt=False),
                    self._loop
                )
</code></pre><h3 id="è´¦æˆ·æ³¨å†Œaccount-registration">è´¦æˆ·æ³¨å†Œï¼ˆAccount Registrationï¼‰</h3>
<p>åœ¨ä¸ Asterisk ç»„åˆçš„ç”Ÿäº§éƒ¨ç½²ä¸­ï¼Œç½‘å…³éœ€è¦åƒæ ‡å‡† SIP ç»ˆç«¯ä¸€æ ·å‘ PBX æ³¨å†Œï¼š</p>
<pre tabindex="0"><code>class SipAgent:
    def _run_pjsua_thread(self, loop: asyncio.AbstractEventLoop) -&gt; None:
        self._ep = pj.Endpoint()
        self._ep.libCreate()
        self._ep.libInit(ep_cfg)
        self._ep.transportCreate(pj.PJSIP_TRANSPORT_UDP, transport_cfg)
        self._ep.libStart()

        self._account = GatewayAccount(self._logger, self._bridge, self._voicelive_client, loop)

        if self._settings.sip.register_with_server and self._settings.sip.server:
            acc_cfg = pj.AccountConfig()
            acc_cfg.idUri = f&#34;sip:{self._settings.sip.user}@{self._settings.sip.server}&#34;
            acc_cfg.regConfig.registrarUri = f&#34;sip:{self._settings.sip.server}&#34;

            # Digest authentication credentials
            cred = pj.AuthCredInfo()
            cred.scheme = &#34;digest&#34;
            cred.realm = self._settings.sip.auth_realm or &#34;*&#34;
            cred.username = self._settings.sip.auth_user
            cred.data = self._settings.sip.auth_password
            cred.dataType = pj.PJSIP_CRED_DATA_PLAIN_PASSWD
            acc_cfg.sipConfig.authCreds.append(cred)

            self._account.create(acc_cfg)
</code></pre><h2 id="voice-live-é›†æˆ">Voice Live é›†æˆ</h2>
<h3 id="azure-voice-live-æ¦‚è§ˆ">Azure Voice Live æ¦‚è§ˆ</h3>
<p>Azure Voice Live æ˜¯ä¸€ä¸ª <strong>å®æ—¶ã€åŒå‘çš„å¯¹è¯å¼ AI æœåŠ¡</strong>ï¼ŒæŠŠä¸‹é¢èƒ½åŠ›æ•´åˆåˆ°ä¸€èµ·ï¼š</p>
<ul>
<li><strong>GPT-4o Realtime Preview</strong>ï¼šé¢å‘å£è¯­å¯¹è¯ä¼˜åŒ–çš„è¶…ä½å»¶è¿Ÿè¯­è¨€æ¨¡å‹</li>
<li><strong>æµå¼è¯­éŸ³è¯†åˆ«</strong>ï¼šè¿ç»­è½¬å†™ï¼Œå¹¶æä¾›è¯çº§æ—¶é—´æˆ³</li>
<li><strong>ç¥ç» TTS</strong>ï¼šæ›´è‡ªç„¶çš„åˆæˆå£°éŸ³ï¼Œå¹¶å…·å¤‡æƒ…æ„Ÿè¡¨è¾¾</li>
<li><strong>æœåŠ¡ç«¯ VAD</strong>ï¼šé€šè¿‡è¯­éŸ³æ´»åŠ¨æ£€æµ‹ï¼ˆVADï¼‰åšè‡ªåŠ¨è½®æ¬¡åˆ‡æ¢ï¼Œæ— éœ€é¢å¤–æç¤ºè¯</li>
</ul>
<h3 id="å®¢æˆ·ç«¯å®ç°clientpy">å®¢æˆ·ç«¯å®ç°ï¼šclient.py</h3>
<pre tabindex="0"><code>class VoiceLiveClient:
    &#34;&#34;&#34;Manages lifecycle of an Azure Voice Live WebSocket connection.&#34;&#34;&#34;

    async def connect(self) -&gt; None:
        if self._settings.azure.api_key:
            credential = AzureKeyCredential(self._settings.azure.api_key)
        else:
            # Use AAD authentication (Managed Identity or Service Principal)
            self._aad_credential = DefaultAzureCredential()
            credential = await self._aad_credential.__aenter__()

        self._connection_cm = connect(
            endpoint=self._settings.azure.endpoint,
            credential=credential,
            model=self._settings.azure.model,
        )
        self._connection = await self._connection_cm.__aenter__()

        # Configure session parameters
        session = RequestSession(
            model=&#34;gpt-4o&#34;,
            modalities=[Modality.TEXT, Modality.AUDIO],
            instructions=self._settings.azure.instructions,
            input_audio_format=InputAudioFormat.PCM16,
            output_audio_format=OutputAudioFormat.PCM16,
            input_audio_transcription=AudioInputTranscriptionOptions(model=&#34;azure-speech&#34;),
            turn_detection=ServerVad(
                threshold=0.5,
                prefix_padding_ms=200,
                silence_duration_ms=400
            ),
            voice=AzureStandardVoice(name=self._settings.azure.voice)
        )
        await self._connection.session.update(session=session)
</code></pre><p><strong>å…³é”®é…ç½®ç‚¹</strong>ï¼š</p>
<ul>
<li><code>turn_detection=ServerVad(...)</code>ï¼šç”± Azure åˆ¤æ–­ç”¨æˆ·ä½•æ—¶åœæ­¢è¯´è¯ï¼Œå¹¶è‡ªåŠ¨è§¦å‘ AI ç”Ÿæˆå“åº”ï¼›æ— éœ€å”¤é†’è¯æˆ–æ˜¾å¼æç¤º</li>
<li><code>prefix_padding_ms=200</code>ï¼šä¿ç•™è¯­éŸ³æ£€æµ‹å‰ 200ms éŸ³é¢‘ï¼Œé¿å…æˆªæ–­è¿‡ç¡¬</li>
<li><code>silence_duration_ms=400</code>ï¼šæ£€æµ‹åˆ° 400ms é™éŸ³åè®¤å®šè½®æ¬¡ç»“æŸ</li>
</ul>
<p><strong>æµå¼å“åº”éŸ³é¢‘</strong>ï¼šAI ç”Ÿæˆçš„è¯­éŸ³ä¼šä»¥ <code>RESPONSE_AUDIO_DELTA</code> äº‹ä»¶åˆ†ç‰‡åˆ°è¾¾ï¼ˆbase64 ç¼–ç çš„ PCM16 chunksï¼‰ã€‚ç½‘å…³è§£ç åç«‹å³é€šè¿‡éŸ³é¢‘æ¡¥æ¥ä¸‹å‘ï¼Œå®ç°ä½å»¶è¿Ÿæ’­æ”¾ã€‚</p>
<h2 id="ç”Ÿäº§éƒ¨ç½²audiocodes--asterisk">ç”Ÿäº§éƒ¨ç½²ï¼šAudiocodes + Asterisk</h2>
<h3 id="ä¸ºä»€ä¹ˆé€‰æ‹©è¿™ç§æ‹“æ‰‘">ä¸ºä»€ä¹ˆé€‰æ‹©è¿™ç§æ‹“æ‰‘ï¼Ÿ</h3>
<table>
  <thead>
      <tr>
          <th>ç»„ä»¶</th>
          <th>è§’è‰²</th>
          <th>æ”¶ç›Š</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>Audiocodes SBC</strong></td>
          <td>ä¼šè¯è¾¹ç•Œæ§åˆ¶å™¨</td>
          <td>- NAT/é˜²ç«å¢™ç©¿é€ - å®‰å…¨ï¼ˆDOS é˜²æŠ¤ã€åŠ å¯†ï¼‰ - åè®®è§„èŒƒåŒ– - æ‹“æ‰‘éšè— - åª’ä½“é”šå®šï¼ˆå¯é€‰è½¬ç ï¼‰</td>
      </tr>
      <tr>
          <td><strong>Asterisk PBX</strong></td>
          <td>SIP æœåŠ¡å™¨</td>
          <td>- å‘¼å«è·¯ç”±ä¸ IVR - ç”¨æˆ·ç›®å½•ä¸é‰´æƒ - è½¬æ¥/ä¿æŒ/ä¼šè®®ç­‰é«˜çº§å‘¼å«èƒ½åŠ› - CDR/åˆ†æ - ä¸ä¼ä¸šç”µè¯ç³»ç»Ÿé›†æˆ</td>
      </tr>
      <tr>
          <td><strong>Voice Live Gateway</strong></td>
          <td>AI å¯¹è¯ç«¯ç‚¹</td>
          <td>- å®æ—¶ AI å¯¹è¯ - è‡ªç„¶è¯­è¨€ç†è§£ - åŠ¨æ€å“åº”ç”Ÿæˆ - å¤šè¯­è¨€æ”¯æŒ</td>
      </tr>
  </tbody>
</table>
<h3 id="ç½‘ç»œæ¶æ„">ç½‘ç»œæ¶æ„</h3>
<pre tabindex="0"><code>                    Internet
                       â”‚
                       â”‚ SIP/RTP
                       â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   Audiocodes SBC        â”‚
         â”‚   Public IP: X.X.X.X    â”‚
         â”‚   Ports: 5060, 10000+   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ Private Network
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   Asterisk PBX          â”‚
         â”‚   Internal: 10.0.1.10   â”‚
         â”‚   Port: 5060            â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Voice Live Gateway     â”‚
         â”‚  Internal: 10.0.1.20    â”‚
         â”‚  Port: 5060             â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
         â”‚  â”‚ Outbound HTTPS    â”‚  â”‚
         â”‚  â”‚ to Azure          â”‚  â”‚
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ Internet (HTTPS/WSS)
                      â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Azure Voice Live API  â”‚
         â”‚  *.cognitiveservices   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre><h3 id="audiocodes-sbc-é…ç½®">Audiocodes SBC é…ç½®</h3>
<h4 id="1-åˆ°-asterisk-çš„-sip-trunkip-group">1. åˆ° Asterisk çš„ SIP Trunkï¼ˆIP Groupï¼‰</h4>
<pre tabindex="0"><code>IP Group Settings:
- Name: Asterisk-Trunk
- Type: Server
- SIP Group Name: asterisk.internal.example.com
- Media Realm: Private
- Proxy Set: Asterisk-ProxySet
- Classification: Classify by Proxy Set
- SBC Operation Mode: SBC-Only
- Topology Location: Internal Network
</code></pre><h4 id="2-asterisk-çš„-proxy-set">2. Asterisk çš„ Proxy Set</h4>
<pre tabindex="0"><code>Proxy Set Name: Asterisk-ProxySet
Proxy Address: 10.0.1.10:5060
Transport Type: UDP
Load Balancing Method: Parking Lot
</code></pre><h4 id="3-ip-to-ip-è·¯ç”±è§„åˆ™">3. IP-to-IP è·¯ç”±è§„åˆ™</h4>
<pre tabindex="0"><code>Rule Name: PSTN-to-Gateway
Source IP Group: PSTN-Trunk
Destination IP Group: Asterisk-Trunk
Call Trigger: Any
Destination Prefix Manipulation: None
Message Manipulation: None
</code></pre><h4 id="4-åª’ä½“è®¾ç½®">4. åª’ä½“è®¾ç½®</h4>
<pre tabindex="0"><code>Media Realm: Private
IPv4 Interface: LAN1 (10.0.1.1)
Media Security: None (or SRTP if required)
Codec Preference Order: G711Ulaw, G711Alaw
Transcoding: Disabled (pass-through)
RTP Port Range: 10000-20000
</code></pre><h3 id="asterisk-é…ç½®">Asterisk é…ç½®</h3>
<h4 id="etcasteriskpjsipconf">/etc/asterisk/pjsip.conf</h4>
<pre tabindex="0"><code>;=====================================
; Transport Configuration
;=====================================
[transport-udp]
type=transport
protocol=udp
bind=0.0.0.0:5060
local_net=10.0.0.0/8

;=====================================
; Voice Live Gateway Endpoint
;=====================================
[voicelive-gateway]
type=endpoint
context=voicelive-routing
aors=voicelive-gateway
auth=voicelive-auth
disallow=all
allow=ulaw
allow=alaw
direct_media=no
force_rport=yes
rewrite_contact=yes
rtp_symmetric=yes
ice_support=no

[voicelive-gateway]
type=aor
contact=sip:10.0.1.20:5060
qualify_frequency=30

[voicelive-auth]
type=auth
auth_type=userpass
username=
password=
realm=sip.example.com

;=====================================
; SBC Trunk (for inbound calls)
;=====================================
[audiocodes-sbc]
type=endpoint
context=from-sbc
aors=audiocodes-sbc
disallow=all
allow=ulaw
allow=alaw

[audiocodes-sbc]
type=aor
contact=sip:10.0.1.1:5060
</code></pre><h4 id="etcasteriskextensionsconf">/etc/asterisk/extensions.conf</h4>
<pre tabindex="0"><code>;=====================================
; Incoming calls from SBC
;=====================================
[from-sbc]
; Example: Route calls to 800-AI-VOICE to the gateway
exten =&gt; 8002486423,1,NoOp(Routing to Voice Live Gateway)
 same =&gt; n,Set(CALLERID(name)=AI Assistant)
 same =&gt; n,Dial(PJSIP/voicelive-bot@voicelive-gateway,30)
 same =&gt; n,Hangup()

; Default handler for unmatched numbers
exten =&gt; _X.,1,NoOp(Unrouted call: ${EXTEN})
 same =&gt; n,Playback(invalid)
 same =&gt; n,Hangup()

;=====================================
; Voice Live Gateway routing context
;=====================================
[voicelive-routing]
exten =&gt; _X.,1,NoOp(Call from gateway: ${CALLERID(num)})
 same =&gt; n,Hangup()
</code></pre><h3 id="ç½‘å…³é…ç½®">ç½‘å…³é…ç½®</h3>
<p>åˆ›å»º <code>/opt/voicelive-gateway/.env</code>ï¼š</p>
<pre tabindex="0"><code>#=====================================
# SIP Configuration
#=====================================
SIP_SERVER=asterisk.internal.example.com
SIP_PORT=5060
SIP_USER=voicelive-bot@sip.example.com
AUTH_USER=voicelive-bot
AUTH_REALM=sip.example.com
AUTH_PASSWORD=
REGISTER_WITH_SIP_SERVER=true
DISPLAY_NAME=Voice Live Bot

#=====================================
# Network Configuration
#=====================================
SIP_LOCAL_ADDRESS=0.0.0.0
SIP_VIA_ADDR=10.0.1.20
MEDIA_ADDRESS=10.0.1.20
MEDIA_PORT=10000
MEDIA_PORT_COUNT=1000

#=====================================
# Azure Voice Live
#=====================================
AZURE_VOICELIVE_ENDPOINT=wss://xxxxxx.cognitiveservices.azure.com/openai/realtime
AZURE_VOICELIVE_API_KEY=
VOICE_LIVE_MODEL=gpt-4o
VOICE_LIVE_VOICE=en-US-AvaNeural
VOICE_LIVE_INSTRUCTIONS=You are a helpful customer service assistant for Contoso Inc. Answer questions about account balances, order status, and general inquiries. Be friendly and concise.
VOICE_LIVE_MAX_RESPONSE_OUTPUT_TOKENS=200
VOICE_LIVE_PROACTIVE_GREETING_ENABLED=true
VOICE_LIVE_PROACTIVE_GREETING=Thank you for calling Contoso customer service. How can I help you today?

#=====================================
# Logging
#=====================================
LOG_LEVEL=INFO
VOICE_LIVE_LOG_FILE=/var/log/voicelive-gateway/gateway.log
</code></pre><h3 id="systemd-æœåŠ¡linux">Systemd æœåŠ¡ï¼ˆLinuxï¼‰</h3>
<p>åˆ›å»º <code>/etc/systemd/system/voicelive-gateway.service</code>ï¼š</p>
<pre tabindex="0"><code>[Unit]
Description=Voice Live SIP Gateway
After=network.target

[Service]
Type=simple
User=voicelive
Group=voicelive
WorkingDirectory=/opt/voicelive-gateway
EnvironmentFile=/opt/voicelive-gateway/.env
ExecStart=/opt/voicelive-gateway/.venv/bin/python3 -m voicelive_sip_gateway.gateway.main
Restart=on-failure
RestartSec=10
StandardOutput=journal
StandardError=journal

# Security hardening
NoNewPrivileges=true
PrivateTmp=true
ProtectSystem=strict
ReadWritePaths=/var/log/voicelive-gateway

[Install]
WantedBy=multi-user.target
</code></pre><p>å¯ç”¨å¹¶å¯åŠ¨ï¼š</p>
<p>sudo systemctl daemon-reload sudo systemctl enable voicelive-gateway sudo systemctl start voicelive-gateway sudo systemctl status voicelive-gateway</p>
<h2 id="é…ç½®æŒ‡å—">é…ç½®æŒ‡å—</h2>
<h3 id="ç¯å¢ƒå˜é‡å‚è€ƒ">ç¯å¢ƒå˜é‡å‚è€ƒ</h3>
<table>
  <thead>
      <tr>
          <th>Variable</th>
          <th>Description</th>
          <th>Example</th>
          <th>Required</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>Azure Voice Live</strong></td>
          <td></td>
          <td></td>
          <td></td>
      </tr>
      <tr>
          <td>AZURE_VOICELIVE_ENDPOINT</td>
          <td>WebSocket endpoint URL</td>
          <td>wss://myresource.cognitiveservices.azure.com/openai/realtime</td>
          <td>âœ…</td>
      </tr>
      <tr>
          <td>AZURE_VOICELIVE_API_KEY</td>
          <td>API key (or use AAD)</td>
          <td>abc123&hellip;</td>
          <td>âœ…*</td>
      </tr>
      <tr>
          <td>VOICE_LIVE_MODEL</td>
          <td>Model identifier</td>
          <td>gpt-4o</td>
          <td>âŒ (default: gpt-4o)</td>
      </tr>
      <tr>
          <td>VOICE_LIVE_VOICE</td>
          <td>TTS voice name</td>
          <td>en-US-AvaNeural</td>
          <td>âŒ</td>
      </tr>
      <tr>
          <td>VOICE_LIVE_INSTRUCTIONS</td>
          <td>System prompt</td>
          <td>You are a helpful assistant</td>
          <td>âŒ</td>
      </tr>
      <tr>
          <td>VOICE_LIVE_MAX_RESPONSE_OUTPUT_TOKENS</td>
          <td>Max tokens per response</td>
          <td>200</td>
          <td>âŒ</td>
      </tr>
      <tr>
          <td>VOICE_LIVE_PROACTIVE_GREETING_ENABLED</td>
          <td>Enable greeting on connect</td>
          <td>true</td>
          <td>âŒ</td>
      </tr>
      <tr>
          <td>VOICE_LIVE_PROACTIVE_GREETING</td>
          <td>Greeting message</td>
          <td>Hello! How can I help?</td>
          <td>âŒ</td>
      </tr>
      <tr>
          <td><strong>SIP Configuration</strong></td>
          <td></td>
          <td></td>
          <td></td>
      </tr>
      <tr>
          <td>SIP_SERVER</td>
          <td>Asterisk/PBX hostname</td>
          <td>asterisk.example.com</td>
          <td>âœ…**</td>
      </tr>
      <tr>
          <td>SIP_PORT</td>
          <td>SIP port</td>
          <td>5060</td>
          <td>âŒ (default: 5060)</td>
      </tr>
      <tr>
          <td>SIP_USER</td>
          <td>SIP user URI</td>
          <td><a href="mailto:bot@sip.example.com">bot@sip.example.com</a></td>
          <td>âœ…**</td>
      </tr>
      <tr>
          <td>AUTH_USER</td>
          <td>Auth username</td>
          <td>bot</td>
          <td>âœ…**</td>
      </tr>
      <tr>
          <td>AUTH_REALM</td>
          <td>Auth realm</td>
          <td>sip.example.com</td>
          <td>âœ…**</td>
      </tr>
      <tr>
          <td>AUTH_PASSWORD</td>
          <td>Auth password</td>
          <td>securepass</td>
          <td>âœ…**</td>
      </tr>
      <tr>
          <td>REGISTER_WITH_SIP_SERVER</td>
          <td>Enable registration</td>
          <td>true</td>
          <td>âŒ (default: false)</td>
      </tr>
      <tr>
          <td>DISPLAY_NAME</td>
          <td>Caller ID name</td>
          <td>Voice Live Bot</td>
          <td>âŒ</td>
      </tr>
      <tr>
          <td><strong>Network Settings</strong></td>
          <td></td>
          <td></td>
          <td></td>
      </tr>
      <tr>
          <td>SIP_LOCAL_ADDRESS</td>
          <td>Local bind address</td>
          <td>0.0.0.0</td>
          <td>âŒ (default: 127.0.0.1)</td>
      </tr>
      <tr>
          <td>SIP_VIA_ADDR</td>
          <td>Via header IP</td>
          <td>10.0.1.20</td>
          <td>âŒ</td>
      </tr>
      <tr>
          <td>MEDIA_ADDRESS</td>
          <td>RTP bind address</td>
          <td>10.0.1.20</td>
          <td>âŒ</td>
      </tr>
      <tr>
          <td>MEDIA_PORT</td>
          <td>RTP port range start</td>
          <td>10000</td>
          <td>âŒ</td>
      </tr>
      <tr>
          <td>MEDIA_PORT_COUNT</td>
          <td>RTP port range count</td>
          <td>1000</td>
          <td>âŒ</td>
      </tr>
      <tr>
          <td><strong>Logging</strong></td>
          <td></td>
          <td></td>
          <td></td>
      </tr>
      <tr>
          <td>LOG_LEVEL</td>
          <td>Log verbosity</td>
          <td>INFO</td>
          <td>âŒ (default: INFO)</td>
      </tr>
      <tr>
          <td>VOICE_LIVE_LOG_FILE</td>
          <td>Log file path</td>
          <td>logs/gateway.log</td>
          <td>âŒ</td>
      </tr>
  </tbody>
</table>
<p>*Either <code>AZURE_VOICELIVE_API_KEY</code> or AAD environment variables (<code>AZURE_CLIENT_ID</code>, <code>AZURE_TENANT_ID</code>, <code>AZURE_CLIENT_SECRET</code>) are required.</p>
<p>**Required only when <code>REGISTER_WITH_SIP_SERVER=true</code>.</p>
<h2 id="æœ¬åœ°æµ‹è¯•æ­å»ºlocal-testing-setup">æœ¬åœ°æµ‹è¯•æ­å»ºï¼ˆLocal Testing Setupï¼‰</h2>
<p>å¦‚æœä½ æƒ³ä¸ä¾èµ– SBC/PBX åŸºç¡€è®¾æ–½è¿›è¡Œå¿«é€ŸéªŒè¯ï¼Œå¯ä»¥æŒ‰ä¸‹é¢æ­¥éª¤åšæœ¬åœ°æµ‹è¯•ã€‚</p>
<h3 id="å‰ç½®æ¡ä»¶prerequisites">å‰ç½®æ¡ä»¶ï¼ˆPrerequisitesï¼‰</h3>
<ol>
<li><strong>å®‰è£… pjproject åŠ Python bindings</strong>ï¼š</li>
</ol>
<pre tabindex="0"><code>
git clone https://github.com/pjsip/pjproject.git?WT.mc_id=AI-MVP-5003172 cd pjproject ./configure CFLAGS=&#34;-O2 -DNDEBUG&#34; &amp;&amp; make dep &amp;&amp; make cd pjsip-apps/src/swig make export PYTHONPATH=$PWD:$PYTHONPATH
</code></pre><ol>
<li><strong>å®‰è£…ç½‘å…³ä¾èµ–</strong>ï¼š</li>
</ol>
<pre tabindex="0"><code>cd /path/to/azure-voicelive-sip-python python3 -m venv .venv source .venv/bin/activate pip install -e .[dev]
</code></pre><ol>
<li><strong>å®‰è£… PortAudio</strong>ï¼ˆå¯é€‰ï¼šç”¨äºæœ¬æœºæ‰¬å£°å™¨æ’­æ”¾ï¼‰ï¼š</li>
</ol>
<pre tabindex="0"><code># macOS brew install portaudio # Ubuntu/Debian sudo apt-get install portaudio19-dev
</code></pre><h3 id="æœ¬åœ°é…ç½®">æœ¬åœ°é…ç½®</h3>
<p>åˆ›å»º <code>.env</code>ï¼š</p>
<pre tabindex="0"><code># No SIP server - direct connection
REGISTER_WITH_SIP_SERVER=false
SIP_LOCAL_ADDRESS=127.0.0.1
SIP_VIA_ADDR=127.0.0.1
MEDIA_ADDRESS=127.0.0.1

# Azure Voice Live
AZURE_VOICELIVE_ENDPOINT=wss://your-resource.cognitiveservices.azure.com/openai/realtime
AZURE_VOICELIVE_API_KEY=your-api-key

# Logging
LOG_LEVEL=DEBUG
VOICE_LIVE_LOG_FILE=logs/gateway.log
</code></pre><h3 id="è¿è¡Œç½‘å…³">è¿è¡Œç½‘å…³</h3>
<pre tabindex="0"><code># Load environment variables set -a &amp;&amp; source .env &amp;&amp; set +a # Start gateway make run # Or manually: PYTHONPATH=src python3 -m voicelive_sip_gateway.gateway.main
</code></pre><p>æœŸæœ›è¾“å‡ºï¼ˆç¤ºä¾‹ï¼‰ï¼š</p>
<p>2025-11-27 10:15:32 [info ] voicelive.connected endpoint=wss://&hellip; 2025-11-27 10:15:32 [info ] sip.transport_created port=5060 2025-11-27 10:15:32 [info ] sip.agent_started address=127.0.0.1 port=5060</p>
<h3 id="è¿æ¥-sip-è½¯ç”µè¯softphone">è¿æ¥ SIP è½¯ç”µè¯ï¼ˆSoftphoneï¼‰</h3>
<p>å¯ç”¨çš„å…è´¹ SIP å®¢æˆ·ç«¯ï¼š</p>
<ul>
<li><strong>Windows/macOS</strong>: <a href="https://www.microsip.org/?WT.mc_id=AI-MVP-5003172">MicroSIP</a>ã€<a href="https://www.zoiper.com/?WT.mc_id=AI-MVP-5003172">Zoiper</a></li>
<li><strong>Linux</strong>: <a href="https://www.linphone.org/?WT.mc_id=AI-MVP-5003172">Linphone</a></li>
<li><strong>iOS/Android</strong>: Linphoneã€Zoiper</li>
</ul>
<p>é…ç½®è½¯ç”µè¯ï¼ˆç¤ºä¾‹ï¼‰ï¼š</p>
<p>Account Settings: - Username: test - Domain: 127.0.0.1 - Port: 5060 - Transport: UDP - Registration: Disabled (direct connection) To call: sip:test@127.0.0.1:5060</p>
<p><strong>é¢„æœŸå‘¼å«æµç¨‹</strong>ï¼š</p>
<ol>
<li>Dial <code>sip:test@127.0.0.1:5060</code></li>
<li>Gateway answers with 200 OK</li>
<li>Hear AI greeting: &ldquo;Thank you for calling. How can I help you today?&rdquo;</li>
<li>Speak your question</li>
<li>Hear AI-generated response</li>
</ol>
<h3 id="å»¶è¿Ÿé¢„ç®—latency-budget">å»¶è¿Ÿé¢„ç®—ï¼ˆLatency Budgetï¼‰</h3>
<table>
  <thead>
      <tr>
          <th>Component</th>
          <th>Typical Latency</th>
          <th>Notes</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>Network (caller â†’ gateway)</strong></td>
          <td>10-50ms</td>
          <td>Depends on ISP, distance</td>
      </tr>
      <tr>
          <td><strong>SIP/RTP processing</strong></td>
          <td>&lt;5ms</td>
          <td>pjproject is highly optimized</td>
      </tr>
      <tr>
          <td><strong>Audio resampling</strong></td>
          <td>&lt;2ms</td>
          <td>scipy.resample_poly is efficient</td>
      </tr>
      <tr>
          <td><strong>WebSocket (gateway â†’ Azure)</strong></td>
          <td>20-80ms</td>
          <td>Depends on region, network</td>
      </tr>
      <tr>
          <td><strong>Voice Live processing</strong></td>
          <td>200-500ms</td>
          <td>STT + LLM inference + TTS</td>
      </tr>
      <tr>
          <td><strong>Total round-trip</strong></td>
          <td><strong>250-650ms</strong></td>
          <td>Perceived as near real-time</td>
      </tr>
  </tbody>
</table>
<p><strong>ä¼˜åŒ–å»ºè®®</strong>ï¼š</p>
<ol>
<li>å°½é‡æŠŠç½‘å…³éƒ¨ç½²åœ¨ä¸ Voice Live èµ„æºç›¸åŒçš„ Azure åŒºåŸŸ</li>
<li>åœ¨ Audiocodes SBC ä¸Šå¯ç”¨ expedited routingï¼ˆåŒæ—¶å…³é—­ä¸å¿…è¦çš„ media anchoringï¼‰</li>
<li>å°½é‡å‡å°‘ SIP hopï¼šç®€å•åœºæ™¯å¯ç›´æ¥ SBC â†’ Gatewayï¼ˆè·³è¿‡ Asteriskï¼‰</li>
<li>ç›‘æ§é˜Ÿåˆ—æ·±åº¦ï¼šå½“ <code>_inbound_queue</code> æˆ– <code>_outbound_queue</code> è¶…è¿‡ 10 ä¸ª item æ—¶è¾“å‡ºè­¦å‘Š</li>
</ol>
<h3 id="å…³é”®æ—¥å¿—äº‹ä»¶key-log-events">å…³é”®æ—¥å¿—äº‹ä»¶ï¼ˆKey Log Eventsï¼‰</h3>
<table>
  <thead>
      <tr>
          <th>Event</th>
          <th>Meaning</th>
          <th>Action</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>sip.agent_started</td>
          <td>Gateway listening</td>
          <td>âœ… Normal</td>
      </tr>
      <tr>
          <td>sip.incoming_call</td>
          <td>New call received</td>
          <td>âœ… Normal</td>
      </tr>
      <tr>
          <td>sip.media_active</td>
          <td>Audio bridge established</td>
          <td>âœ… Normal</td>
      </tr>
      <tr>
          <td>voicelive.connected</td>
          <td>WebSocket connected</td>
          <td>âœ… Normal</td>
      </tr>
      <tr>
          <td>voicelive.audio_delta</td>
          <td>AI audio chunk received</td>
          <td>âœ… Normal</td>
      </tr>
      <tr>
          <td>voicelive.event_error</td>
          <td>Voice Live API error</td>
          <td>âš ï¸ Check API key, quota</td>
      </tr>
      <tr>
          <td>media.enqueue_failed</td>
          <td>Audio queue full</td>
          <td>âš ï¸ CPU overload or slow network</td>
      </tr>
      <tr>
          <td>sip.thread_error</td>
          <td>pjsua crash</td>
          <td>ğŸ”´ Restart gateway</td>
      </tr>
  </tbody>
</table>
<h3 id="å¸¸è§é—®é¢˜common-issues">å¸¸è§é—®é¢˜ï¼ˆCommon Issuesï¼‰</h3>
<h4 id="1-å¬ä¸åˆ°æ¥ç”µæ–¹éŸ³é¢‘">1. <strong>å¬ä¸åˆ°æ¥ç”µæ–¹éŸ³é¢‘</strong></h4>
<p><strong>ç°è±¡</strong>ï¼šAI å¯¹ä½ çš„è®²è¯æ²¡æœ‰å“åº”</p>
<p><strong>è¯Šæ–­</strong>ï¼š</p>
<h1 id="check-rtp-packets-arriving-sudo-tcpdump--i-any--n-udp-port-10000-11000">Check RTP packets arriving sudo tcpdump -i any -n udp port 10000-11000</h1>
<p><strong>è§£å†³</strong>ï¼š</p>
<ul>
<li>ç¡®è®¤ <code>MEDIA_ADDRESS</code> ä¸ç½‘å…³å¯è¾¾ IP ä¸€è‡´</li>
<li>æ£€æŸ¥é˜²ç«å¢™ï¼ˆæ”¾è¡Œ UDP 10000-11000ï¼‰</li>
<li>ç¡®è®¤ Asterisk é…ç½®ï¼š<code>direct_media=no</code> ä¸” <code>rtp_symmetric=yes</code></li>
</ul>
<h4 id="2-éŸ³é¢‘æ–­ç»­å¡é¡¿choppy-audio">2. <strong>éŸ³é¢‘æ–­ç»­/å¡é¡¿ï¼ˆChoppy audioï¼‰</strong></h4>
<p><strong>ç°è±¡</strong>ï¼šå£°éŸ³å‘â€œæœºæ¢°éŸ³â€ã€æœ‰æ˜æ˜¾æ‰åŒ…</p>
<p><strong>è¯Šæ–­</strong>ï¼šæŸ¥çœ‹æ—¥å¿—ä¸­çš„é˜Ÿåˆ—æ·±åº¦</p>
<p><strong>è§£å†³</strong>ï¼š</p>
<ul>
<li>å¢åŠ  CPU èµ„æº</li>
<li>é™ä½ <code>VOICE_LIVE_MAX_RESPONSE_OUTPUT_TOKENS</code>ï¼Œå‡å°‘ç”Ÿæˆæ—¶é—´</li>
<li>æ£€æŸ¥ç½‘ç»œæŠ–åŠ¨ï¼ˆç›®æ ‡ &lt;30msï¼‰</li>
</ul>
<h4 id="3-sip-æ³¨å†Œå¤±è´¥">3. <strong>SIP æ³¨å†Œå¤±è´¥</strong></h4>
<p><strong>ç°è±¡</strong>ï¼šAsterisk æ‰§è¡Œ <code>pjsip show endpoints</code> æ˜¾ç¤º <code>Unreachable</code></p>
<p><strong>è¯Šæ–­</strong>ï¼š</p>
<h1 id="on-asterisk-pjsip-set-logger-on--watch-for-register-attempts">On Asterisk pjsip set logger on # Watch for REGISTER attempts</h1>
<p><strong>è§£å†³</strong>ï¼š</p>
<ul>
<li>æ ¸å¯¹ <code>AUTH_USER</code> / <code>AUTH_PASSWORD</code> / <code>AUTH_REALM</code> ä¸ Asterisk <code>pjsip.conf</code> ä¸€è‡´</li>
<li>æ£€æŸ¥ç½‘ç»œè¿é€šæ€§ï¼š<code>ping asterisk.example.com</code></li>
<li>ç¡®è®¤ <code>REGISTER_WITH_SIP_SERVER=true</code></li>
</ul>
<h2 id="ç»“è¯­">ç»“è¯­</h2>
<p>è¿™å¥—æ–¹æ¡ˆç»™å‡ºäº†ä¸€ä¸ªâ€œç”Ÿäº§çº§æ¡¥æ¥å™¨â€çš„å‚è€ƒå®ç°ï¼šåœ¨ç”µè¯è¯­éŸ³ä¸–ç•Œä¸ Azure çš„ AI Voice Live æœåŠ¡ä¹‹é—´å»ºç«‹ç¨³å®šã€ä½å»¶è¿Ÿçš„åŒå‘åª’ä½“é€šé“ã€‚æ–‡ç« ä¸­å¼ºè°ƒçš„æˆæœåŒ…æ‹¬ï¼š</p>
<p>âœ… <strong>å®æ—¶éŸ³é¢‘è½¬ç </strong>ï¼šé¢å¤–å¼€é”€ &lt;5ms
âœ… <strong>å¥å£®çš„ SIP æ ˆ</strong>ï¼šåŸºäºå·¥ä¸šçº§ pjproject
âœ… <strong>å¼‚æ­¥æ¶æ„</strong>ï¼šå…·å¤‡æ›´é«˜å¹¶å‘æ½œåŠ›
âœ… <strong>ä¼ä¸šçº§éƒ¨ç½²æ‹“æ‰‘</strong>ï¼šAudiocodes SBC + Asterisk PBX
âœ… <strong>å¯è§‚æµ‹æ€§</strong>ï¼šç»“æ„åŒ–æ—¥å¿—è´¯ç©¿å…¨é“¾è·¯</p>
<h3 id="ä¸‹ä¸€æ­¥next-steps">ä¸‹ä¸€æ­¥ï¼ˆNext Stepsï¼‰</h3>
<p>å¯ä»¥è€ƒè™‘çš„å¢å¼ºæ–¹å‘ï¼š</p>
<ol>
<li><strong>å¤šé€šè¯æ”¯æŒ</strong>ï¼šé‡æ„ä¸ºå•å®ä¾‹æ”¯æŒå¤šä¸ªå¹¶å‘å‘¼å«</li>
<li><strong>DTMF</strong>ï¼šå®ç° RFC 2833ï¼Œç”¨äº IVR åœºæ™¯</li>
<li><strong>å‘¼å«è½¬æ¥</strong>ï¼šæ”¯æŒ SIP REFERï¼ŒæŠŠæ¥ç”µè½¬ç»™äººå·¥åå¸­</li>
<li><strong>å½•éŸ³ä¸åˆè§„</strong>ï¼šå°†ä¼šè¯å†™å…¥ Azure Blob Storage</li>
<li><strong>æŒ‡æ ‡ä½“ç³»</strong>ï¼šè¾“å‡º Prometheus æŒ‡æ ‡ï¼ˆæ—¶é•¿ã€é”™è¯¯ç‡ã€å»¶è¿Ÿåˆ†ä½æ•°ï¼‰</li>
<li><strong>Kubernetes</strong>ï¼šç”¨ Helm chart åšç½‘å…³çš„è‡ªåŠ¨æ‰©ç¼©</li>
<li><strong>TLS/SRTP</strong>ï¼šç«¯åˆ°ç«¯åŠ å¯† SIP ä¿¡ä»¤ä¸ RTP åª’ä½“</li>
</ol>
<h3 id="å‚è€ƒèµ„æº">å‚è€ƒèµ„æº</h3>
<ul>
<li><strong>Azure Voice Live Documentation</strong>: <a href="https://learn.microsoft.com/azure/ai-services/speech-service/voice-live?WT.mc_id=AI-MVP-5003172">https://learn.microsoft.com/azure/ai-services/speech-service/voice-live?WT.mc_id=AI-MVP-5003172</a></li>
</ul>
<h3 id="è·å–ä»£ç get-the-code">è·å–ä»£ç ï¼ˆGet the Codeï¼‰</h3>
<p>å®Œæ•´æºç åœ¨ GitHubï¼š</p>
<p><a href="https://github.com/monuminu/azure-voicelive-sip-python?WT.mc_id=AI-MVP-5003172">https://github.com/monuminu/azure-voicelive-sip-python?WT.mc_id=AI-MVP-5003172</a></p>

        </div>

        
<div class="post-archive">
    <ul class="post-copyright">
        <li><strong>åŸæ–‡ä½œè€…ï¼š</strong><a rel="author" href="https://beanhsiang.github.io/">BeanHsiang</a></li>
        <li style="word-break:break-all"><strong>åŸæ–‡é“¾æ¥ï¼š</strong><a href="https://beanhsiang.github.io/post/2026-01-04-building-a-production-ready-sip-gateway-for-azure-voice-live/">https://beanhsiang.github.io/post/2026-01-04-building-a-production-ready-sip-gateway-for-azure-voice-live/</a></li>
        <li><strong>ç‰ˆæƒå£°æ˜ï¼š</strong>æœ¬ä½œå“é‡‡ç”¨<a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç¦æ­¢æ¼”ç» 4.0 å›½é™…è®¸å¯åè®®</a>. è¿›è¡Œè®¸å¯ï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼ˆä½œè€…ï¼ŒåŸæ–‡é“¾æ¥ï¼‰ï¼Œå•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒã€‚</li>
    </ul>
</div>
<br/>



        

<div class="post-archive">
    <h2>ç›¸å…³æ–‡ç« </h2>
    <ul class="listing">
        
        <li><a href="/post/2026-01-01-why-web-ai-agents-are-more-vulnerable-than-standalone-llms-and-how-we-should-actually-fix-it/">ä¸ºä»€ä¹ˆ Web AI Agent æ¯”ç‹¬ç«‹ LLM æ›´è„†å¼±â€”â€”ä»¥åŠæˆ‘ä»¬åº”è¯¥å¦‚ä½•çœŸæ­£ä¿®å¤å®ƒ</a></li>
        
        <li><a href="/post/2025-12-12-observability-for-multi-agent-systems-with-microsoft-agent-framework-and-azure-ai-foundry/">ä½¿ç”¨ Microsoft Agent Framework ä¸ Azure AI Foundry ä¸ºå¤šæ™ºèƒ½ä½“ç³»ç»Ÿæ„å»ºå¯è§‚æµ‹æ€§</a></li>
        
        <li><a href="/post/2025-11-22-hybrid-ai-using-foundry-local-microsoft-foundry-and-the-agent-framework-part-2/">ä½¿ç”¨ Foundry Localã€Microsoft Foundry ä¸ Agent Framework æ„å»ºæ··åˆ AIï¼ˆä¸‹ï¼‰ï¼šäº‘ç«¯ agent å®‰å…¨å›æ‹¨æœ¬åœ°ç§å¯†ä¸Šä¸‹æ–‡</a></li>
        
        <li><a href="/post/2025-11-21-hybrid-ai-using-foundry-local-microsoft-foundry-and-the-agent-framework-part-1/">ä½¿ç”¨ Foundry Localã€Microsoft Foundry ä¸ Agent Framework æ„å»ºæ··åˆ AIï¼ˆä¸Šï¼‰ï¼šéšç§ä¼˜å…ˆçš„æœ¬åœ°&#43;äº‘ç«¯ååŒ</a></li>
        
        <li><a href="/post/2025-11-08-monitoring-generative-ai-applications-with-azure-ai-foundry/">ä½¿ç”¨ Azure AI Foundry ç›‘æ§ç”Ÿæˆå¼ AI åº”ç”¨</a></li>
        
    </ul>
</div>


        <div class="post-meta meta-tags">
            
            <ul class="clearfix">
                
                <li><a href='/tags/Microsoft-Foundry' target="_blank">Microsoft Foundry</a></li>
                
            </ul>
            
        </div>
    </article>
    
    

    
    
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "BeanHsiang/Greedy"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
    
    
    

</div>

                    <footer id="footer">
    <div>
        &copy; 2026 <a href="https://beanhsiang.github.io/">Innovation with tech By BeanHsiang</a>
        
    </div>
    <br />
    <div>
        <div class="github-badge">
            <a href="https://gohugo.io/" target="_black" rel="nofollow"><span class="badge-subject">Powered by</span><span class="badge-value bg-blue">Hugo</span></a>
        </div>
        <div class="github-badge">
            <a href="https://github.com/flysnow-org/maupassant-hugo" target="_black"><span class="badge-subject">Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a>
        </div>
    </div>
</footer>


    
    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script><script src="//cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>

<style type="text/css">
div.highlight {
    position: relative;
    margin: 1em 0px;
}

.copy-code {
    display: none;
    position: absolute;
    top: 4px;
    right: 4px;
    color: rgba(255, 255, 255, 0.8);
    background: rgba(78, 78, 78, 0.8);
    border-radius: var(--radius);
    padding: 0 5px;
    font: inherit;
    user-select: none;
    cursor: pointer;
    border: 0;
    --radius: 8px;
}

div.highlight:hover .copy-code,pre:hover .copy-code {
    display: block;
}

</style>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>


    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='https://beanhsiang.github.io/search' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://beanhsiang.github.io/">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>

    <section class="widget">
        <h3 class="widget-title">æœ€è¿‘æ–‡ç« </h3>
<ul class="widget-list">
    
    <li>
        <a href="https://beanhsiang.github.io/post/2026-01-04-building-a-production-ready-sip-gateway-for-azure-voice-live/" title="ä¸º Azure Voice Live æ„å»ºå¯ç”¨äºç”Ÿäº§çš„ SIP ç½‘å…³" target="_blank">ä¸º Azure Voice Live æ„å»ºå¯ç”¨äºç”Ÿäº§çš„ SIP ç½‘å…³</a>
    </li>
    
    <li>
        <a href="https://beanhsiang.github.io/post/2026-01-01-why-web-ai-agents-are-more-vulnerable-than-standalone-llms-and-how-we-should-actually-fix-it/" title="ä¸ºä»€ä¹ˆ Web AI Agent æ¯”ç‹¬ç«‹ LLM æ›´è„†å¼±â€”â€”ä»¥åŠæˆ‘ä»¬åº”è¯¥å¦‚ä½•çœŸæ­£ä¿®å¤å®ƒ" target="_blank">ä¸ºä»€ä¹ˆ Web AI Agent æ¯”ç‹¬ç«‹ LLM æ›´è„†å¼±â€”â€”ä»¥åŠæˆ‘ä»¬åº”è¯¥å¦‚ä½•çœŸæ­£ä¿®å¤å®ƒ</a>
    </li>
    
    <li>
        <a href="https://beanhsiang.github.io/post/2025-12-12-observability-for-multi-agent-systems-with-microsoft-agent-framework-and-azure-ai-foundry/" title="ä½¿ç”¨ Microsoft Agent Framework ä¸ Azure AI Foundry ä¸ºå¤šæ™ºèƒ½ä½“ç³»ç»Ÿæ„å»ºå¯è§‚æµ‹æ€§" target="_blank">ä½¿ç”¨ Microsoft Agent Framework ä¸ Azure AI Foundry ä¸ºå¤šæ™ºèƒ½ä½“ç³»ç»Ÿæ„å»ºå¯è§‚æµ‹æ€§</a>
    </li>
    
    <li>
        <a href="https://beanhsiang.github.io/post/2025-11-22-hybrid-ai-using-foundry-local-microsoft-foundry-and-the-agent-framework-part-2/" title="ä½¿ç”¨ Foundry Localã€Microsoft Foundry ä¸ Agent Framework æ„å»ºæ··åˆ AIï¼ˆä¸‹ï¼‰ï¼šäº‘ç«¯ agent å®‰å…¨å›æ‹¨æœ¬åœ°ç§å¯†ä¸Šä¸‹æ–‡" target="_blank">ä½¿ç”¨ Foundry Localã€Microsoft Foundry ä¸ Agent Framework æ„å»ºæ··åˆ AIï¼ˆä¸‹ï¼‰ï¼šäº‘ç«¯ agent å®‰å…¨å›æ‹¨æœ¬åœ°ç§å¯†ä¸Šä¸‹æ–‡</a>
    </li>
    
    <li>
        <a href="https://beanhsiang.github.io/post/2025-11-21-hybrid-ai-using-foundry-local-microsoft-foundry-and-the-agent-framework-part-1/" title="ä½¿ç”¨ Foundry Localã€Microsoft Foundry ä¸ Agent Framework æ„å»ºæ··åˆ AIï¼ˆä¸Šï¼‰ï¼šéšç§ä¼˜å…ˆçš„æœ¬åœ°&#43;äº‘ç«¯ååŒ" target="_blank">ä½¿ç”¨ Foundry Localã€Microsoft Foundry ä¸ Agent Framework æ„å»ºæ··åˆ AIï¼ˆä¸Šï¼‰ï¼šéšç§ä¼˜å…ˆçš„æœ¬åœ°&#43;äº‘ç«¯ååŒ</a>
    </li>
    
    <li>
        <a href="https://beanhsiang.github.io/post/2025-11-08-monitoring-generative-ai-applications-with-azure-ai-foundry/" title="ä½¿ç”¨ Azure AI Foundry ç›‘æ§ç”Ÿæˆå¼ AI åº”ç”¨" target="_blank">ä½¿ç”¨ Azure AI Foundry ç›‘æ§ç”Ÿæˆå¼ AI åº”ç”¨</a>
    </li>
    
    <li>
        <a href="https://beanhsiang.github.io/post/2025-07-03-introducing-awesome-github-copilot-customizations-repo/" title="ä»‹ç» Awesome GitHub Copilot è‡ªå®šä¹‰é…ç½®ä»“åº“ï¼šè®© AI ç¼–ç¨‹åŠ©æ‰‹æ›´æ‡‚ä½ çš„å›¢é˜Ÿ" target="_blank">ä»‹ç» Awesome GitHub Copilot è‡ªå®šä¹‰é…ç½®ä»“åº“ï¼šè®© AI ç¼–ç¨‹åŠ©æ‰‹æ›´æ‡‚ä½ çš„å›¢é˜Ÿ</a>
    </li>
    
    <li>
        <a href="https://beanhsiang.github.io/post/2025-07-02-building-advanced-multi-agent-ai-workflows-by-leveraging-autogen-and-semantic-kernel/" title="æ„å»ºé«˜çº§å¤šæ™ºèƒ½ä½“ AI å·¥ä½œæµï¼šåˆ©ç”¨ AutoGen å’Œ Semantic Kernel" target="_blank">æ„å»ºé«˜çº§å¤šæ™ºèƒ½ä½“ AI å·¥ä½œæµï¼šåˆ©ç”¨ AutoGen å’Œ Semantic Kernel</a>
    </li>
    
    <li>
        <a href="https://beanhsiang.github.io/post/2025-06-30-ai-automation-in-azure-foundry-through-turnkey-mcp-integration-and-computer-use/" title="é€šè¿‡MCPä¸€é”®é›†æˆå’ŒComputer Use Agentæ¨¡å‹ï¼Œå®ç°Azure Foundryä¸­çš„AIè‡ªåŠ¨åŒ–" target="_blank">é€šè¿‡MCPä¸€é”®é›†æˆå’ŒComputer Use Agentæ¨¡å‹ï¼Œå®ç°Azure Foundryä¸­çš„AIè‡ªåŠ¨åŒ–</a>
    </li>
    
    <li>
        <a href="https://beanhsiang.github.io/post/2025-06-17-interpretation-of-the-microsoft-azure-openai-api-version-lifecycle/" title="å¾®è½¯ Azure OpenAI API ç‰ˆæœ¬ç”Ÿå‘½å‘¨æœŸè§£è¯»" target="_blank">å¾®è½¯ Azure OpenAI API ç‰ˆæœ¬ç”Ÿå‘½å‘¨æœŸè§£è¯»</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title"><a href='/categories/'>åˆ†ç±»</a></h3>
<ul class="widget-list">
    
    <li><a href="https://beanhsiang.github.io/categories/AI-Agent/">AI Agent (3)</a></li>
    
    <li><a href="https://beanhsiang.github.io/categories/Azure-AI/">Azure AI (38)</a></li>
    
    <li><a href="https://beanhsiang.github.io/categories/FireUG/">FireUG (5)</a></li>
    
    <li><a href="https://beanhsiang.github.io/categories/GitHub-Copilot/">GitHub Copilot (2)</a></li>
    
    <li><a href="https://beanhsiang.github.io/categories/Machine-Learning/">Machine Learning (1)</a></li>
    
    <li><a href="https://beanhsiang.github.io/categories/Microsoft-Foundry/">Microsoft Foundry (6)</a></li>
    
    <li><a href="https://beanhsiang.github.io/categories/ML.NET/">ML.NET (8)</a></li>
    
    <li><a href="https://beanhsiang.github.io/categories/Model-Based-Machine-Learning/">Model-Based Machine Learning (7)</a></li>
    
    <li><a href="https://beanhsiang.github.io/categories/%E7%A9%BF%E8%B6%8A%E4%BA%BA%E6%9C%BA%E8%9E%8D%E5%90%88%E4%B9%8B%E9%99%85/">ç©¿è¶Šäººæœºèåˆä¹‹é™… (6)</a></li>
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title"><a href='/tags/'>æ ‡ç­¾</a></h3>
<div class="tagcloud">
    
    <a href="https://beanhsiang.github.io/tags/.NET/">.NET</a>
    
    <a href="https://beanhsiang.github.io/tags/A2A/">A2A</a>
    
    <a href="https://beanhsiang.github.io/tags/Agentic-AI/">Agentic AI</a>
    
    <a href="https://beanhsiang.github.io/tags/AI-Agent/">AI Agent</a>
    
    <a href="https://beanhsiang.github.io/tags/AutoGen/">AutoGen</a>
    
    <a href="https://beanhsiang.github.io/tags/Azure-AI/">Azure AI</a>
    
    <a href="https://beanhsiang.github.io/tags/Azure-AI-Agent/">Azure AI Agent</a>
    
    <a href="https://beanhsiang.github.io/tags/Azure-AI-Search/">Azure AI Search</a>
    
    <a href="https://beanhsiang.github.io/tags/Azure-Machine-Learning/">Azure Machine Learning</a>
    
    <a href="https://beanhsiang.github.io/tags/Azure-OpenAI/">Azure OpenAI</a>
    
    <a href="https://beanhsiang.github.io/tags/Azure-Speech/">Azure Speech</a>
    
    <a href="https://beanhsiang.github.io/tags/CSnakes/">CSnakes</a>
    
    <a href="https://beanhsiang.github.io/tags/FireUG/">FireUG</a>
    
    <a href="https://beanhsiang.github.io/tags/Gemini/">Gemini</a>
    
    <a href="https://beanhsiang.github.io/tags/GitHub-Copilot/">GitHub Copilot</a>
    
    <a href="https://beanhsiang.github.io/tags/GPT-4o/">GPT-4o</a>
    
    <a href="https://beanhsiang.github.io/tags/GPT-4o-Realtime-Preview/">GPT-4o Realtime Preview</a>
    
    <a href="https://beanhsiang.github.io/tags/Machine-Learning/">Machine Learning</a>
    
    <a href="https://beanhsiang.github.io/tags/Magentic-One/">Magentic-One</a>
    
    <a href="https://beanhsiang.github.io/tags/MarkItDown/">MarkItDown</a>
    
    <a href="https://beanhsiang.github.io/tags/MCP/">MCP</a>
    
    <a href="https://beanhsiang.github.io/tags/Microsoft-Entra-ID/">Microsoft Entra ID</a>
    
    <a href="https://beanhsiang.github.io/tags/Microsoft-Foundry/">Microsoft Foundry</a>
    
    <a href="https://beanhsiang.github.io/tags/ML.NET/">ML.NET</a>
    
    <a href="https://beanhsiang.github.io/tags/MLX/">MLX</a>
    
    <a href="https://beanhsiang.github.io/tags/Model-Context-Protocol/">Model Context Protocol</a>
    
    <a href="https://beanhsiang.github.io/tags/Model-Based/">Model-Based</a>
    
    <a href="https://beanhsiang.github.io/tags/Multi-Agent/">Multi-Agent</a>
    
    <a href="https://beanhsiang.github.io/tags/Phi-3/">Phi-3</a>
    
    <a href="https://beanhsiang.github.io/tags/Phi-4/">Phi-4</a>
    
    <a href="https://beanhsiang.github.io/tags/PydanticAI/">PydanticAI</a>
    
    <a href="https://beanhsiang.github.io/tags/q-learning/">Q-Learning</a>
    
    <a href="https://beanhsiang.github.io/tags/RAFT/">RAFT</a>
    
    <a href="https://beanhsiang.github.io/tags/RAG/">RAG</a>
    
    <a href="https://beanhsiang.github.io/tags/Real-Time-API/">Real-Time API</a>
    
    <a href="https://beanhsiang.github.io/tags/reinforcement-learning/">Reinforcement Learning</a>
    
    <a href="https://beanhsiang.github.io/tags/Semantic-Kernel/">Semantic Kernel</a>
    
    <a href="https://beanhsiang.github.io/tags/Semantic-Ranking/">Semantic Ranking</a>
    
    <a href="https://beanhsiang.github.io/tags/Speech-Recognition/">Speech Recognition</a>
    
    <a href="https://beanhsiang.github.io/tags/Transcribe/">Transcribe</a>
    
    <a href="https://beanhsiang.github.io/tags/Vector-Search/">Vector Search</a>
    
    <a href="https://beanhsiang.github.io/tags/VoiceRAG/">VoiceRAG</a>
    
    <a href="https://beanhsiang.github.io/tags/VSCode/">VSCode</a>
    
    <a href="https://beanhsiang.github.io/tags/Websocket/">Websocket</a>
    
    <a href="https://beanhsiang.github.io/tags/%E7%A9%BF%E8%B6%8A%E4%BA%BA%E6%9C%BA%E8%9E%8D%E5%90%88%E4%B9%8B%E9%99%85/">ç©¿è¶Šäººæœºèåˆä¹‹é™…</a>
    
</div>
    </section>

    
<section class="widget">
    <h3 class="widget-title">å‹æƒ…é“¾æ¥</h3>
    <ul class="widget-list">
        
        <li>
            <a target="_blank" href="https://fireusergroup.com/" title="FireUG">FireUG æŠ€æœ¯ç¤¾åŒº</a>
        </li>
        
        <li>
            <a target="_blank" href="https://space.bilibili.com/545713776" title="FireUG æŠ€æœ¯ç¤¾åŒº - B ç«™">FireUG æŠ€æœ¯ç¤¾åŒº - B ç«™</a>
        </li>
        
        <li>
            <a target="_blank" href="https://www.douyin.com/user/MS4wLjABAAAAYGG_Q3--hpBKc7rq2h-slFNFObDCmrxYc8OF2tl_mV4" title="ç«æ²¹é¸¡">ç«æ²¹é¸¡</a>
        </li>
        
    </ul>
</section>


    <section class="widget">
        <h3 class="widget-title">å…¶å®ƒ</h3>
        <ul class="widget-list">
            <li><a href="https://beanhsiang.github.io/index.xml">æ–‡ç«  RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
</body>

</html>